<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FarNutri: Seu Guia Suplementativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* GlobalStyles from React component */
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: #FFF1F2; color: #1e293b; /* bg-rose-50 text-slate-800 */ }
        
        .hero-bg-custom { 
            background: linear-gradient(to right, #e11d48, #be123c); 
            padding-top: 5rem; /* py-20 */
            padding-bottom: 5rem; /* py-20 */
            position: relative; 
            overflow: hidden; 
        }
        @media (min-width: 768px) {
            .hero-bg-custom {
                padding-top: 7rem; /* md:py-28 */
                padding-bottom: 7rem; /* md:py-28 */
            }
        }
        .hero-bg-custom::before { 
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(circle at 100% 150%, rgba(255,255,255,0.1) 0%, transparent 70%), radial-gradient(circle at 0% -50%, rgba(255,255,255,0.1) 0%, transparent 70%);
            opacity: 0.3; z-index: 0;
        }
        .hero-bg-custom > .container { position: relative; z-index: 1; }
        .hero-bg-custom .hero-title-custom { 
            font-size: 3rem; 
            line-height: 1.1;
            font-weight: 800; 
            margin-bottom: 1.5rem; 
            letter-spacing: -0.025em; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.3); 
        }
        @media (min-width: 640px) { 
            .hero-bg-custom .hero-title-custom { font-size: 3.75rem; }
        }
        @media (min-width: 768px) { 
            .hero-bg-custom .hero-title-custom { font-size: 4.5rem; }
        }

        .hero-bg-custom .hero-subtitle-custom { 
            font-size: 1.125rem; 
            line-height: 1.75rem;
            margin-bottom: 3rem; 
            max-width: 48rem; 
            margin-left: auto;
            margin-right: auto;
            line-height: 1.625; 
            opacity: 0.95; 
        }
         @media (min-width: 768px) { 
            .hero-bg-custom .hero-subtitle-custom { font-size: 1.25rem; line-height: 1.75rem; }
        }

        .hero-bg-custom .cta-button-hero { 
            background-color: #ffffff; 
            color: #be123c; 
            font-weight: 700; 
            padding: 1rem 2.5rem; 
            border-radius: 0.75rem; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); 
            transition: all 0.3s ease-in-out;
            font-size: 1.125rem; 
            border-width: 2px;
            border-color: #ffe4e6; 
        }
        .hero-bg-custom .cta-button-hero:hover {
            background-color: #fff1f2; 
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); 
            transform: scale(1.05); 
            border-color: #ffffff; 
        }
        
        .hero-bg-custom .disclaimer-box-hero { 
            background-color: rgba(255,255,255,0.2); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255,255,255,0.3); 
            padding: 1.5rem; 
            border-radius: 1.5rem; 
            margin-top: 4rem; 
            max-width: 56rem; 
            margin-left: auto;
            margin-right: auto;
            text-align: left;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); 
        }
        
        .section-title-custom { 
            font-size: 2.25rem; 
            line-height: 2.5rem;
            font-weight: 800; 
            text-align: center;
            margin-bottom: 1rem; 
            color: #be123c; 
        }
        .section-title-custom.large-bold { font-size: 3rem; line-height: 1; font-weight: 900; } 
        .section-title-custom.red-bold-large { color: #be123c; font-size: 3rem; line-height: 1; font-weight: 800; }


        .section-title-subtle-custom { 
            text-align: center; 
            color: #475569; 
            margin-bottom: 4rem; 
            font-size: 1.125rem; 
            line-height: 1.75rem;
            max-width: 42rem; 
            margin-left: auto;
            margin-right: auto;
            line-height: 1.625; 
        }
        
        .suplemento-detalhe-content-custom h3 { font-size: 1.5rem; line-height: 2rem; font-weight: 700; color: #be123c; margin-bottom: 1.25rem; margin-top: 2rem; }
        .suplemento-detalhe-content-custom h3:first-child { margin-top: 0; }
        .suplemento-detalhe-content-custom h4 { font-size: 1.25rem; line-height: 1.75rem; font-weight: 600; color: #dc2626; margin-top: 1.5rem; margin-bottom: 0.75rem; }
        .suplemento-detalhe-content-custom p, .suplemento-detalhe-content-custom li { margin-bottom: 0.75rem; line-height: 1.625; color: #334155; }
        .suplemento-detalhe-content-custom ul, .suplemento-detalhe-content-custom ol { list-style-type: disc; list-style-position: inside; padding-left: 0.75rem; margin-bottom: 0.75rem; }
        .suplemento-detalhe-content-custom ul li, .suplemento-detalhe-content-custom ol li { margin-bottom: 0.375rem; }


        .content-box-custom { background-color: #ffffff; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); margin-bottom: 3rem; }
         @media (min-width: 768px) { .content-box-custom { padding: 2.5rem; } }

        .biblioteca-suplemento-card {
            background-image: linear-gradient(to bottom right, #ef4444, #be123c); 
            padding: 0.25rem; 
            border-radius: 1rem; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); 
            transition: all 0.3s ease-in-out;
            transform: scale(1);
            min-height: 200px; 
        }
        .biblioteca-suplemento-card:hover {
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); 
            transform: scale(1.05); 
        }
        .biblioteca-suplemento-card-inner {
            background-color: rgba(255,255,255,0.9); 
            backdrop-filter: blur(4px); 
            border-radius: 0.875rem; 
            height: 100%; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem; 
            text-align: center;
            cursor: pointer;
        }
        .biblioteca-suplemento-card-title {
            font-size: 1.5rem; 
            line-height: 2rem;
            font-weight: 800; 
            color: #be123c; 
            line-height: 1.25; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.1); 
        }
         @media (min-width: 768px) { .biblioteca-suplemento-card-title { font-size: 1.875rem; line-height: 2.25rem; } } 
         .biblioteca-suplemento-card:hover .biblioteca-suplemento-card-title {
            color: #dc2626; 
        }


        .suplemento-card-custom { position: relative; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); overflow: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; transition: all 0.3s ease-in-out; min-height: 180px; }
        .suplemento-card-custom::before { 
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(to bottom, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.4) 100%); 
            z-index: 1; opacity: 0; transition: opacity 0.3s ease-in-out; 
        }
        .suplemento-card-custom:hover::before { opacity: 1; }
        .suplemento-card-content-custom { position: relative; z-index: 20; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 1rem; text-align: center; }
        .suplemento-card-title-custom { font-size: 1.875rem; line-height: 2.25rem; font-weight: 800; line-height: 1.25; text-shadow: 0 2px 4px rgba(0,0,0,0.5); transition: transform 0.3s ease-in-out; }
         @media (min-width: 768px) { .suplemento-card-title-custom { font-size: 2.25rem; line-height: 2.5rem; } } 
        .suplemento-card-custom:hover .suplemento-card-title-custom { transform: translateY(-5px); }

        .cta-button-custom { background-color: #dc2626; color: #ffffff; font-weight: 600; padding: 0.875rem 1.75rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); transition: all 0.3s ease-in-out; display: inline-flex; align-items: center; justify-content: center; font-size: 1rem; line-height: 1.5rem; transform: scale(1); }
        .cta-button-custom:hover { background-color: #be123c; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); transform: scale(1.05); }
        
        .cta-button-catalogo-pessoal {
            background-image: linear-gradient(to right, #ef4444, #ec4899); 
            color: #ffffff; font-weight: 700; padding: 1rem 2rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); transition: all 0.3s ease-in-out; display: inline-flex; align-items: center; justify-content: center; font-size: 1.125rem; line-height: 1.75rem; transform: scale(1);
        }
        .cta-button-catalogo-pessoal:hover {
            background-image: linear-gradient(to right, #dc2626, #db2777); 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); transform: scale(1.05);
        }


        .disclaimer-box-custom { background-color: #fffbeb; border-left: 4px solid #f59e0b; color: #92400e; padding: 1.25rem; border-radius: 0.5rem; margin-top: 1.5rem; margin-bottom: 1.5rem; font-size: 0.875rem; line-height: 1.25rem; line-height: 1.625; box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06); }
        .disclaimer-box-strong-custom { background-color: #fdf2f8; border-left: 4px solid #db2777; color: #831843; padding: 1.25rem; border-radius: 0.5rem; margin-top: 1.5rem; margin-bottom: 1.5rem; font-weight: 500; box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06); }
        .disclaimer-box-strong-custom p:first-child { font-size: 1.125rem; line-height: 1.75rem; font-weight: 700; color: #831843; }
        .disclaimer-box-strong-custom.large-title { font-size: 1.5rem; line-height: 2rem; font-weight: 700; margin-bottom: 0.75rem; } 


        .assistente-form-container-custom { background-color: #ffffff; padding: 2rem; border-radius: 1.5rem; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); max-width: 48rem; margin-left: auto; margin-right: auto; border: 1px solid #ffe4e6; }
         @media (min-width: 768px) { .assistente-form-container-custom { padding: 3rem; } }
        .assistente-resultado-container-custom { margin-top: 2rem; background-color: #fff1f2; padding: 1.5rem; border-radius: 0.75rem; border: 1px solid #fecdd3; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); color: #334155; }
        .assistente-resultado-container-custom strong { color: #be123c; }

        .voltar-catalogo-btn-custom { margin-bottom: 2.5rem; color: #dc2626; font-weight: 600; display: inline-flex; align-items: center; transition: color 0.2s ease-in-out; font-size: 1rem; line-height: 1.5rem; padding: 0.5rem 1rem; border-radius: 0.5rem; background-color: #fee2e2; box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06); }
        .voltar-catalogo-btn-custom:hover { color: #be123c; background-color: #fecdd3; }
        .voltar-catalogo-btn-custom svg { margin-right: 0.625rem; height: 1.25rem; width: 1.25rem; }

        .suplemento-detalhe-header-block-custom { text-align: center; border-radius: 1rem; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); display: flex; align-items: center; justify-content: center; min-height: 200px; }
        .suplemento-detalhe-header-block-custom h2 { color: #ffffff; font-size: 3rem; line-height: 1; font-weight: 800; line-height: 1.25; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
         @media (min-width: 640px) { .suplemento-detalhe-header-block-custom h2 { font-size: 3.75rem; line-height: 1; } } 
         @media (min-width: 768px) { .suplemento-detalhe-header-block-custom h2 { font-size: 4.5rem; line-height: 1; } } 
         @media (min-width: 1024px) { .suplemento-detalhe-header-block-custom h2 { font-size: 6rem; line-height: 1; } } 
        
        .loader-custom { border: 4px solid #fdf2f2; border-top: 4px solid #e11d48; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #ffe4e6; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #f43f5e; border-radius: 10px; border: 2px solid #ffe4e6; }
        ::-webkit-scrollbar-thumb:hover { background: #e11d48; }

        .prose-gemini h1 { font-size: 1.5rem; line-height: 2rem; font-weight: 700; color: #be123c; margin-bottom: 0.75rem; }
        .prose-gemini h2 { font-size: 1.25rem; line-height: 1.75rem; font-weight: 600; color: #dc2626; margin-bottom: 0.5rem; margin-top: 1rem; }
        .prose-gemini h3 { font-size: 1.125rem; line-height: 1.75rem; font-weight: 500; color: #ef4444; margin-bottom: 0.5rem; margin-top: 0.75rem; }
        .prose-gemini p { margin-bottom: 0.5rem; color: #334155; font-size: 0.875rem; line-height: 1.25rem; line-height: 1.625; }
        .prose-gemini ul, .prose-gemini ol { list-style-type: disc; list-style-position: inside; padding-left: 1rem; margin-bottom: 0.5rem; font-size: 0.875rem; line-height: 1.25rem; }
        .prose-gemini ul li, .prose-gemini ol li { margin-bottom: 0.25rem; }
        .prose-gemini strong { font-weight: 600; color: #be123c; }
        .prose-gemini a { color: #dc2626; text-decoration: underline; }
        .prose-gemini a:hover { color: #9f1239; }

        /* Custom notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            min-width: 250px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transform: translateX(100%);
        }
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        .notification.success { background-color: #28a745; } /* Green */
        .notification.error { background-color: #dc3545; } /* Red */
        .notification.info { background-color: #17a2b8; } /* Blue */
        .notification-close {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            line-height: 1;
        }
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Higher than notifications */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 450px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #be123c;
            margin-bottom: 1rem;
        }
        .modal-message {
            font-size: 1rem;
            color: #334155;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        .modal-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border: none;
        }
        .modal-button.confirm {
            background-color: #dc2626; /* Red-600 */
            color: white;
        }
        .modal-button.confirm:hover {
            background-color: #be123c; /* Red-700 */
        }
        .modal-button.cancel {
            background-color: #e5e7eb; /* Gray-200 */
            color: #374151; /* Gray-700 */
        }
        .modal-button.cancel:hover {
            background-color: #d1d5db; /* Gray-300 */
        }
        .official-source-button {
            background-color: #0ea5e9; /* Sky-500 */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            font-size: 0.875rem; /* text-sm */
            margin-top: 0.5rem;
            margin-right: 0.5rem; /* Add some spacing between buttons */
        }
        .official-source-button:hover {
            background-color: #0284c7; /* Sky-600 */
        }
    </style>
</head>
<body>
    <div id="app-root">
        <div id="initial-loader" class="flex flex-col items-center justify-center min-h-screen bg-rose-50">
            <div class="loader-custom"></div>
            <p class="mt-4 text-slate-700 text-lg">Carregando FarNutri...</p>
        </div>
        <div id="firebase-error-display" style="display: none; padding: 20px; text-align: center; font-family: sans-serif; color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px;">
            <h2>Erro Crítico</h2>
            <p>Não foi possível conectar aos nossos serviços. Por favor, tente recarregar a página ou contate o suporte se o problema persistir.</p>
            <p id="firebase-error-message-detail"></p>
        </div>

        <div id="main-app-content" class="flex flex-col min-h-screen" style="display: none;">
            <header id="app-header" class="bg-white/95 backdrop-blur-lg shadow-xl sticky top-0 z-50 border-b border-rose-100">
                <nav class="container mx-auto px-4 lg:px-6 py-4">
                    <div class="flex flex-wrap justify-between items-center">
                        <a href="#inicio" data-section-id="inicio" class="nav-link flex items-center group">
                            <svg class="h-9 w-9 text-red-600 mr-2.5 group-hover:text-red-500 transition-colors duration-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                            <span class="text-2xl font-extrabold text-red-700 group-hover:text-red-600 transition-colors duration-300">FarNutri</span>
                        </a>
                        <button id="mobile-menu-button" type="button" class="inline-flex items-center p-2.5 ml-3 text-sm text-slate-500 rounded-lg md:hidden hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-slate-200 transition-colors" aria-controls="mobile-menu-list" aria-expanded="false">
                            <span class="sr-only">Abrir menu principal</span>
                            <svg id="menu-icon-open" class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
                            <svg id="menu-icon-close" class="w-6 h-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                        <div class="hidden w-full md:block md:w-auto" id="mobile-menu-list">
                            <ul class="flex flex-col mt-4 md:flex-row md:space-x-1 md:mt-0 md:text-sm">
                                </ul>
                        </div>
                    </div>
                </nav>
            </header>

            <main class="flex-grow">
                <section id="inicio" class="hero-bg-custom">
                    <div class="container mx-auto px-4 text-center">
                        <h1 class="hero-title-custom text-white">FarNutri: Seu guia suplementativo</h1> 
                        <p class="hero-subtitle-custom text-rose-100">Informações detalhadas e ferramentas úteis sobre suplementos alimentares, baseadas em evidências científicas e dados regulatórios. Capacite suas escolhas!</p>
                        <a href="#biblioteca" data-section-id="biblioteca" class="nav-link cta-button-hero">
                            Explorar Biblioteca
                        </a>
                        <div class="disclaimer-box-hero">
                            <h2 class="font-semibold text-2xl mb-4 text-white">⚠️ Atenção Fundamental:</h2>
                            <p class="text-base leading-relaxed text-rose-100 opacity-95">O FarNutri é uma ferramenta de caráter exclusivamente educativo. As informações e calculadoras aqui apresentadas <strong class="text-white">NÃO substituem, em hipótese alguma, a avaliação, diagnóstico, tratamento ou orientação de um profissional de saúde qualificado</strong> (médico, nutricionista, farmacêutico).</p>
                            <p class="mt-3 text-base leading-relaxed text-rose-100 opacity-95">Antes de usar qualquer suplemento, modificar sua dieta ou rotina, <strong class="text-white">CONSULTE SEMPRE UM PROFISSIONAL DE SAÚDE</strong>. A automedicação e o uso inadequado de suplementos podem ser prejudiciais.</p>
                        </div>
                    </div>
                </section>

                <section id="biblioteca" class="py-20 md:py-24">
                    <div class="container mx-auto px-4">
                        <h2 class="section-title-custom">Biblioteca de Suplementos</h2>
                        <p class="section-title-subtle-custom">
                            Explore informações sobre suplementos comumente utilizados. Clique para detalhes.
                        </p>
                        <div id="biblioteca-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-8 gap-y-10">
                            </div>
                        <div id="biblioteca-detalhes-container" class="mt-16 md:mt-20" style="display: none;">
                            </div>
                    </div>
                </section>

                <section id="catalogoPessoal" class="py-20 md:py-24 bg-rose-100">
                    <div class="container mx-auto px-4">
                        <h2 class="section-title-custom">Catálogo Pessoal</h2>
                        <p class="section-title-subtle-custom">
                            Seus suplementos adicionados. Clique para ver detalhes ou vá para "Adicionar Suplemento" para incluir novos itens.
                        </p>
                        <div id="catalogo-pessoal-loading" class="text-center">
                            <div class="loader-custom"></div>
                            <p class="text-slate-600">Carregando catálogo pessoal...</p>
                        </div>
                        <div id="catalogo-pessoal-error" class="text-center text-red-600" style="display: none;">
                            </div>
                        <div id="catalogo-pessoal-grid-container">
                             <div id="catalogo-pessoal-empty" class="text-center py-10" style="display: none;">
                                </div>
                            <div id="catalogo-pessoal-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-8 gap-y-10" style="display: none;">
                                </div>
                        </div>
                        <div id="catalogo-pessoal-detalhes-container" class="mt-16 md:mt-20" style="display: none;">
                            </div>
                    </div>
                </section>

                <section id="interacoes" class="py-20 md:py-24 bg-rose-100">
                    <div class="container mx-auto px-4">
                        <h2 class="section-title-custom text-3xl md:text-4xl lg:text-5xl font-extrabold">Assistente de Verificação de Interações (com IA Gemini)</h2>
                        <p class="section-title-subtle-custom">Insira dois nomes (suplemento, medicamento ou alimento) para uma análise de possíveis interações fornecida por Inteligência Artificial.</p>
                        <div class="assistente-form-container-custom">
                            <div class="grid sm:grid-cols-2 gap-x-6 gap-y-4 mb-8">
                                <div>
                                    <label for="item1-interacao" class="block text-sm font-semibold text-slate-700 mb-1.5">Item 1 (Suplemento/Medicamento/Alimento):</label>
                                    <input type="text" id="item1-interacao" placeholder="Ex: Ômega 3" class="mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-red-500 focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 sm:text-base p-3.5 transition-all duration-200" />
                                </div>
                                <div>
                                    <label for="item2-interacao" class="block text-sm font-semibold text-slate-700 mb-1.5">Item 2 (Suplemento/Medicamento/Alimento):</label>
                                    <input type="text" id="item2-interacao" placeholder="Ex: Varfarina" class="mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-red-500 focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 sm:text-base p-3.5 transition-all duration-200" />
                                </div>
                            </div>
                            <button id="verificar-interacao-btn" class="w-full sm:w-auto cta-button-custom">
                                <svg class="mr-2 inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v2.5M12 18.5V21M4.929 4.929l1.768 1.768M17.303 17.303l1.768 1.768M3 12h2.5M18.5 12H21M4.929 19.071l1.768-1.768M17.303 6.697l1.768-1.768"/></svg>
                                <span id="verificar-interacao-btn-text">Analisar Interação com IA</span>
                            </button>
                            <div id="interacao-resultado-container" class="assistente-resultado-container-custom mt-10" style="display: none;">
                                </div>
                            <div class="disclaimer-box-strong-custom mt-10">
                                <p class="text-xl md:text-2xl font-bold text-pink-800">⚠️ Ferramenta Educacional Avançada:</p>
                                <p class="mt-2">Este assistente utiliza Inteligência Artificial (IA Gemini) para fornecer uma análise sobre possíveis interações. As informações geradas são para fins <strong>educativos e informativos</strong>.</p>
                                <p class="mt-2"><strong>Esta análise NÃO substitui o aconselhamento de um profissional de saúde.</strong></p>
                                <p class="mt-2"><strong>Sempre discuta todas as suas medicações e suplementos com seus profissionais de saúde.</strong></p>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="nutricao" class="py-20 md:py-24">
                    <div class="container mx-auto px-4">
                        <h2 class="section-title-custom text-red-700 text-3xl md:text-4xl lg:text-5xl font-extrabold">Assistente de Estimativas Nutricionais</h2>
                        <p class="section-title-subtle-custom">Preencha os campos abaixo para obter uma estimativa de suas necessidades calóricas e de macronutrientes.</p>
                        <div class="assistente-form-container-custom">
                            <form id="calculadora-nutricional-form" class="space-y-6">
                                <div class="grid sm:grid-cols-2 gap-x-6 gap-y-4">
                                    <div>
                                        <label for="idade-nutricao" class="block text-sm font-semibold text-slate-700 mb-1.5">Idade (anos):</label>
                                        <input type="number" name="idade" id="idade-nutricao" value="30" placeholder="Ex: 30" required min="1" max="120" class="mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-red-500 focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 sm:text-base p-3.5 transition-all duration-200" />
                                    </div>
                                    <div>
                                        <label for="sexo-nutricao" class="block text-sm font-semibold text-slate-700 mb-1.5">Sexo Biológico:</label>
                                        <select name="sexo" id="sexo-nutricao" required class="mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-red-500 focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 sm:text-base p-3.5 transition-all duration-200">
                                            <option value="masculino">Masculino</option>
                                            <option value="feminino">Feminino</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid sm:grid-cols-2 gap-x-6 gap-y-4">
                                    <div>
                                        <label for="peso-nutricao" class="block text-sm font-semibold text-slate-700 mb-1.5">Peso (kg):</label>
                                        <input type="number" name="peso" id="peso-nutricao" value="70" step="0.1" placeholder="Ex: 70.5" required min="1" class="mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-red-500 focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 sm:text-base p-3.5 transition-all duration-200" />
                                    </div>
                                    <div>
                                        <label for="altura-nutricao" class="block text-sm font-semibold text-slate-700 mb-1.5">Altura (cm):</label>
                                        <input type="number" name="altura" id="altura-nutricao" value="175" placeholder="Ex: 175" required min="1" class="mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-red-500 focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 sm:text-base p-3.5 transition-all duration-200" />
                                    </div>
                                </div>
                                <div>
                                    <label for="atividade-nutricao" class="block text-sm font-semibold text-slate-700 mb-1.5">Nível de Atividade Física:</label>
                                    <select name="atividade" id="atividade-nutricao" required class="mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-red-500 focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 sm:text-base p-3.5 transition-all duration-200">
                                        <option value="1.2">Sedentário (pouco ou nenhum exercício)</option>
                                        <option value="1.375">Levemente Ativo (exercício leve 1-3 dias/semana)</option>
                                        <option value="1.55" selected>Moderadamente Ativo (exercício moderado 3-5 dias/semana)</option>
                                        <option value="1.725">Muito Ativo (exercício intenso 6-7 dias/semana)</option>
                                        <option value="1.9">Extremamente Ativo (exercício muito intenso, trabalho físico)</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full sm:w-auto cta-button-custom">
                                    <svg class="mr-2 inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="8" y1="10" x2="16" y2="10"></line><line x1="8" y1="14" x2="16" y2="14"></line><line x1="8" y1="18" x2="16" y2="18"></line></svg>
                                    Calcular Estimativas
                                </button>
                            </form>
                            <div id="nutricao-resultado-container" class="assistente-resultado-container-custom mt-10" style="display: none;">
                                </div>
                            <div class="disclaimer-box-strong-custom mt-10">
                                <p class="text-xl md:text-2xl font-bold text-pink-800">⚠️ Ferramenta Educacional - Estimativas:</p>
                                <p class="mt-2">Os cálculos são <strong>estimativas gerais</strong>. Suas necessidades reais podem variar. <strong>NÃO utilize como plano nutricional ou substituto para aconselhamento profissional.</strong></p>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="adicionarSuplemento" class="py-20 md:py-24 bg-slate-50" style="display:none;"> <div class="container mx-auto px-4">
                        <h2 class="section-title-custom text-red-700 text-3xl md:text-4xl lg:text-5xl font-extrabold">Adicionar Novo Suplemento</h2>
                        <p class="section-title-subtle-custom">
                            Insira o nome do suplemento para buscar informações automaticamente ou preencha os detalhes manualmente.
                        </p>
                        <div class="assistente-form-container-custom"> 
                            <form id="adicionar-suplemento-form" class="space-y-5">
                                <h3 class="text-2xl font-semibold text-red-700 mb-6 text-center">Adicionar Suplemento ao Catálogo Pessoal</h3>
                                <div id="adicionar-suplemento-error" class="text-sm text-red-600 bg-red-100 p-3 rounded-md text-center mb-4" style="display:none;"></div>
                                <div id="adicionar-suplemento-success" class="text-sm text-green-600 bg-green-100 p-3 rounded-md text-center mb-4" style="display:none;"></div>
                                
                                <div class="space-y-2">
                                    <div>
                                        <label for="nomeSuplemento-add" class="block text-sm font-semibold text-slate-700 mb-1.5 flex items-center">
                                            <svg class="mr-2 text-slate-500" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12.0001 1.50006C12.0001 1.50006 8.25006 5.62506 8.25006 9.37506C8.25006 12.0001 9.75006 15.0001 12.0001 15.0001C12.0001 15.0001 12.7501 18.0001 12.0001 22.5001C12.0001 22.5001 11.2501 18.0001 12.0001 15.0001C14.2501 15.0001 15.7501 12.0001 15.7501 9.37506C15.7501 5.62506 12.0001 1.50006 12.0001 1.50006Z" /></svg>
                                            Nome do Suplemento
                                        </label>
                                        <input type="text" id="nomeSuplemento-add" name="nomeSuplemento" placeholder="Ex: Creatina Monohidratada" class="w-full p-3 border border-slate-300 rounded-xl shadow-sm focus:border-red-500 focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 sm:text-base transition-all duration-200"/>
                                    </div>
                                    <button type="button" id="fetch-supplement-details-btn" class="w-full flex items-center justify-center px-4 py-2.5 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:opacity-50">
                                        <span id="fetch-details-btn-text">
                                            <svg class="mr-2 inline" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                            Buscar Informações (IA)
                                        </span>
                                        <span id="fetch-details-btn-loading" style="display:none;">
                                            <div class="animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"></div>
                                            Buscando...
                                        </span>
                                    </button>
                                </div>
                                
                                <div id="add-suplemento-details-fields" style="display:none;" class="space-y-5">
                                    <div>
                                        <label for="principiosAtivosInput-add" class="block text-sm font-semibold text-slate-700 mb-1.5 flex items-center">
                                            <svg class="mr-2 text-slate-500" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                                            Princípios Ativos
                                        </label>
                                        <textarea id="principiosAtivosInput-add" name="principiosAtivosInput" rows="3" placeholder="Ex: Creatina Monohidratada Pura" class="w-full p-3 border border-slate-300 rounded-xl shadow-sm focus:border-red-500 focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 sm:text-base transition-all duration-200"></textarea>
                                    </div>
                                    <div>
                                        <label for="formaDeUsoInput-add" class="block text-sm font-semibold text-slate-700 mb-1.5 flex items-center">
                                            <svg class="mr-2 text-slate-500" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 14a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm0-5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"></path></svg>
                                            Forma de Uso Recomendada
                                        </label>
                                        <textarea id="formaDeUsoInput-add" name="formaDeUsoInput" rows="4" placeholder="Ex: Diluir 5g (1 dosador) em 200ml de água ou bebida de preferência, uma vez ao dia, ou conforme orientação profissional." class="w-full p-3 border border-slate-300 rounded-xl shadow-sm focus:border-red-500 focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 sm:text-base transition-all duration-200"></textarea>
                                    </div>
                                </div>

                                <div class="flex justify-end space-x-3 pt-5">
                                    <button type="submit" id="save-suplemento-btn" class="cta-button-custom !bg-green-600 hover:!bg-green-700 disabled:opacity-60">
                                        <span id="save-suplemento-btn-text">Adicionar ao Catálogo Pessoal</span>
                                        <span id="save-suplemento-btn-loading" style="display:none;">Salvando...</span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <footer id="sobre" class="bg-slate-900 text-slate-400 py-20">
                    <div class="container mx-auto px-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-x-10 gap-y-12 mb-12">
                            <div>
                                <h5 class="text-xl font-bold text-white mb-5">FarNutri</h5>
                                <p class="text-sm leading-relaxed">Seu guia suplementativo. Nosso objetivo é fornecer dados claros, detalhados e baseados em evidências, sempre incentivando o acompanhamento profissional qualificado.</p>
                            </div>
                            <div>
                                <h5 class="text-xl font-bold text-white mb-5">Links Rápidos</h5>
                                <ul class="space-y-2.5 text-sm">
                                    <li><a href="#inicio" data-section-id="inicio" class="nav-link hover:text-red-400 transition-colors">Início</a></li>
                                    <li><a href="#biblioteca" data-section-id="biblioteca" class="nav-link hover:text-red-400 transition-colors">Biblioteca</a></li>
                                    <li><a href="#catalogoPessoal" data-section-id="catalogoPessoal" class="nav-link hover:text-red-400 transition-colors">Catálogo Pessoal</a></li>
                                    <li><a href="#interacoes" data-section-id="interacoes" class="nav-link hover:text-red-400 transition-colors">Interações (IA)</a></li>
                                    <li><a href="#nutricao" data-section-id="nutricao" class="nav-link hover:text-red-400 transition-colors">Nutrição</a></li>
                                    <li><a href="https://www.gov.br/anvisa/pt-br" target="_blank" rel="noopener noreferrer" class="hover:text-red-400 transition-colors">ANVISA (Site Oficial)</a></li>
                                </ul>
                            </div>
                            <div>
                                <h5 class="text-xl font-bold text-white mb-5">Aviso Legal Fundamental</h5>
                                <p class="text-sm leading-relaxed">As informações contidas neste site são para fins educacionais e não substituem aconselhamento profissional qualificado.</p>
                                <p class="text-sm mt-3 leading-relaxed">Sempre procure o aconselhamento de seu médico ou outro profissional de saúde qualificado.</p>
                            </div>
                        </div>
                        <div class="mt-16 border-t border-slate-700 pt-10 text-center text-xs">
                            <p>&copy; <span id="currentYear"></span> FarNutri. Todos os direitos reservados.</p>
                            <p id="footer-user-id" class="text-slate-600 mt-1" style="display:none;"></p>
                        </div>
                    </div>
                </footer>
            </main>
        </div>
    </div>
    <div id="notification-area" class="fixed top-0 right-0 p-4 space-y-2 z-[1000]"></div>
    <div id="confirmation-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-title" class="modal-title">Confirmar Ação</h3>
            <p id="modal-message" class="modal-message">Você tem certeza?</p>
            <div class="modal-buttons">
                <button id="modal-confirm-button" class="modal-button confirm">Confirmar</button>
                <button id="modal-cancel-button" class="modal-button cancel">Cancelar</button>
            </div>
        </div>
    </div>


    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, where, onSnapshot, doc, setDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Global Variables & Firebase Initialization ---
        const fbConfigFromEnv = typeof __firebase_config !== 'undefined' ? __firebase_config : null;
        const appIdFromEnv = typeof __app_id !== 'undefined' ? __app_id : 'farnutri-html-app-default';
        const initialAuthTokenFromEnv = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        const firebaseConfig = fbConfigFromEnv ? JSON.parse(fbConfigFromEnv) : {
            apiKey: "YOUR_API_KEY", 
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        const currentAppId = appIdFromEnv;

        let fbApp;
        let fbAuth;
        let fbDb;
        let currentUserId = null;
        let headerHeight = 0;

        const initialLoader = document.getElementById('initial-loader');
        const mainAppContent = document.getElementById('main-app-content');
        const firebaseErrorDisplay = document.getElementById('firebase-error-display');
        const firebaseErrorMessageDetail = document.getElementById('firebase-error-message-detail');

        try {
            fbApp = initializeApp(firebaseConfig);
            fbAuth = getAuth(fbApp);
            fbDb = getFirestore(fbApp);
        } catch (error) {
            console.error("Erro ao inicializar Firebase:", error);
            if(initialLoader) initialLoader.style.display = 'none';
            if(firebaseErrorDisplay) firebaseErrorDisplay.style.display = 'block';
            if(firebaseErrorMessageDetail) firebaseErrorMessageDetail.textContent = error.message;
            throw new Error("Firebase initialization failed, stopping script.");
        }

        // --- Simple Notification System ---
        function showNotification(message, type = 'info', duration = 5000) {
            const notificationArea = document.getElementById('notification-area');
            if (!notificationArea) {
                alert(message); 
                return;
            }
            const notificationId = 'notification-' + Date.now();
            let bgColorClass = 'bg-blue-500'; 
            if (type === 'success') bgColorClass = 'bg-green-500';
            else if (type === 'error') bgColorClass = 'bg-red-500';

            const notificationHTML = `
                <div id="${notificationId}" class="notification ${bgColorClass} text-white p-4 rounded-md shadow-lg mb-2">
                    <p>${message}</p>
                    <button onclick="dismissNotification('${notificationId}')" class="notification-close">&times;</button>
                </div>
            `;
            notificationArea.insertAdjacentHTML('beforeend', notificationHTML);
            
            const notificationElement = document.getElementById(notificationId);
            if (notificationElement) {
                requestAnimationFrame(() => { 
                    notificationElement.classList.add('show');
                });

                setTimeout(() => {
                    dismissNotification(notificationId);
                }, duration);
            }
        }

        window.dismissNotification = function(notificationId) { 
            const notificationElement = document.getElementById(notificationId);
            if (notificationElement) {
                notificationElement.classList.remove('show');
                setTimeout(() => { 
                    if (notificationElement.parentNode) { 
                         notificationElement.remove();
                    }
                }, 500); 
            }
        }
        
        // --- Confirmation Modal Logic ---
        const modalOverlay = document.getElementById('confirmation-modal-overlay');
        const modalTitleElem = document.getElementById('modal-title');
        const modalMessageElem = document.getElementById('modal-message');
        const modalConfirmButton = document.getElementById('modal-confirm-button');
        const modalCancelButton = document.getElementById('modal-cancel-button');
        let currentConfirmCallback = null;

        function showConfirmationModal(title, message, onConfirm) {
            modalTitleElem.textContent = title;
            modalMessageElem.textContent = message;
            currentConfirmCallback = onConfirm;
            modalOverlay.classList.add('show');
        }

        function hideConfirmationModal() {
            modalOverlay.classList.remove('show');
            currentConfirmCallback = null;
        }

        modalConfirmButton.addEventListener('click', () => {
            if (currentConfirmCallback) {
                currentConfirmCallback();
            }
            hideConfirmationModal();
        });

        modalCancelButton.addEventListener('click', hideConfirmationModal);
        modalOverlay.addEventListener('click', (event) => { 
            if (event.target === modalOverlay) {
                hideConfirmationModal();
            }
        });


        // --- Helper Functions ---
        function extractColorsFromPlaceholder(url) {
            if (!url) return { bgColor: '#f3f4f6', textColor: '#374151' };
            const match = url.match(/\/([a-fA-F0-9]{6})\/([a-fA-F0-9]{6})\?text=/);
            if (match && match.length === 3) {
                return { bgColor: `#${match[1]}`, textColor: `#${match[2]}` };
            }
            return { bgColor: '#f3f4f6', textColor: '#374151' };
        }

        const iconSVG = {
            sun: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`,
            library: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22h16"></path><path d="M4 18V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12"></path><path d="M9 6v12"></path><path d="M15 6v12"></path><path d="M12 6v12"></path></svg>`,
            bookOpen: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>`,
            sparkles: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v2.5M12 18.5V21M4.929 4.929l1.768 1.768M17.303 17.303l1.768 1.768M3 12h2.5M18.5 12H21M4.929 19.071l1.768-1.768M17.303 6.697l1.768-1.768"/></svg>`,
            calculator: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="8" y1="10" x2="16" y2="10"></line><line x1="8" y1="14" x2="16" y2="14"></line><line x1="8" y1="18" x2="16" y2="18"></line></svg>`,
            plusCircle: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>`,
            info: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>`,
            chevronDown: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>`,
            alertTriangle: `<svg class="mx-auto h-10 w-10 mb-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`,
            fileText: `<svg class="mr-2 text-slate-500" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>`,
            downloadCloud: `<svg class="mr-2" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>`,
            testTube2: `<svg class="mr-2 text-slate-500" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>`,
            pill: `<svg class="mr-2 text-slate-500" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 14a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm0-5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"></path></svg>`,
            trash2: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>`,
            plus: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`,
            link: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.71"></path></svg>`,
            externalLink: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>`,

        };
        
        // --- Header Logic ---
        const appHeader = document.getElementById('app-header');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenuList = document.getElementById('mobile-menu-list');
        const menuIconOpen = document.getElementById('menu-icon-open');
        const menuIconClose = document.getElementById('menu-icon-close');
        let isMobileMenuOpen = false;

        function setHeaderHeight() {
            if (appHeader) {
                headerHeight = appHeader.offsetHeight;
            }
        }

        const navLinksData = [
            { id: 'inicio', label: 'Início', icon: iconSVG.sun },
            { id: 'biblioteca', label: 'Biblioteca', icon: iconSVG.library },
            { id: 'catalogoPessoal', label: 'Catálogo Pessoal', icon: iconSVG.bookOpen },
            { id: 'interacoes', label: 'Interações (IA)', icon: iconSVG.sparkles },
            { id: 'nutricao', label: 'Nutrição', icon: iconSVG.calculator },
            { id: 'adicionarSuplemento', label: 'Adicionar Suplemento', icon: iconSVG.plusCircle },
            { id: 'sobre', label: 'Sobre', icon: iconSVG.info },
        ];

        function renderNavLinks() {
            const ul = mobileMenuList.querySelector('ul');
            ul.innerHTML = ''; 
            navLinksData.forEach(link => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${link.id}`;
                a.dataset.sectionId = link.id; 
                a.classList.add('nav-link', 'flex', 'items-center', 'px-3', 'py-2', 'rounded-lg', 'text-sm', 'font-semibold', 'transition-all', 'duration-200', 'ease-in-out', 'text-slate-700', 'hover:text-red-600', 'hover:bg-slate-50');
                a.innerHTML = `${link.icon ? `<span class="mr-1.5">${link.icon}</span>` : ''}${link.label}`;
                a.addEventListener('click', (e) => handleNavigate(e, link.id));
                li.appendChild(a);
                ul.appendChild(li);
            });
        }
        
        if (mobileMenuButton) {
            mobileMenuButton.addEventListener('click', () => {
                isMobileMenuOpen = !isMobileMenuOpen;
                mobileMenuList.classList.toggle('hidden', !isMobileMenuOpen);
                menuIconOpen.classList.toggle('hidden', isMobileMenuOpen);
                menuIconClose.classList.toggle('hidden', !isMobileMenuOpen);
                mobileMenuButton.setAttribute('aria-expanded', isMobileMenuOpen.toString());
                setHeaderHeight(); 
            });
        }

        // --- Navigation Logic ---
        function handleNavigate(event, sectionId) {
            event.preventDefault();
            const element = document.getElementById(sectionId);
            if (element) {
                const elementPosition = element.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerHeight;
                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
            if (isMobileMenuOpen) {
                isMobileMenuOpen = false;
                mobileMenuList.classList.add('hidden');
                menuIconOpen.classList.remove('hidden');
                menuIconClose.classList.add('hidden');
                mobileMenuButton.setAttribute('aria-expanded', 'false');
            }
            updateActiveNavLink(sectionId);
        }
        
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => handleNavigate(e, link.dataset.sectionId));
        });


        // --- Active Nav Link Highlighting ---
        let currentActiveSection = 'inicio';
        function updateActiveNavLink(sectionId) {
            currentActiveSection = sectionId;
            document.querySelectorAll('#mobile-menu-list .nav-link').forEach(navLink => {
                if (navLink.dataset.sectionId === sectionId) {
                    navLink.classList.add('bg-red-100', 'text-red-700', 'shadow-md', 'transform', 'scale-105');
                    navLink.classList.remove('text-slate-700', 'hover:text-red-600', 'hover:bg-slate-50');
                } else {
                    navLink.classList.remove('bg-red-100', 'text-red-700', 'shadow-md', 'transform', 'scale-105');
                    navLink.classList.add('text-slate-700', 'hover:text-red-600', 'hover:bg-slate-50');
                }
            });
        }

        // --- Intersection Observer for Scroll Spy ---
        const sectionsForObserver = ['inicio', 'biblioteca', 'catalogoPessoal', 'interacoes', 'nutricao', 'adicionarSuplemento', 'sobre'];
        let observer;

        function setupIntersectionObserver() {
            if (observer) observer.disconnect(); 

            const topMarginValue = -(headerHeight + 40);
            const bottomVisibleArea = 100; 
            const bottomMarginValue = -(window.innerHeight - headerHeight - bottomVisibleArea);
            const currentRootMargin = `${topMarginValue}px 0px ${bottomMarginValue}px 0px`;

            const observerOptions = {
                root: null,
                rootMargin: currentRootMargin,
                threshold: 0.01 
            };

            const observerCallback = (entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const rect = entry.target.getBoundingClientRect();
                        const isTopVisible = rect.top >= headerHeight && rect.top < window.innerHeight / 2;
                        if(isTopVisible || (rect.height > window.innerHeight && rect.top < headerHeight && rect.bottom > window.innerHeight /2) ){
                           if (currentActiveSection !== entry.target.id) {
                                updateActiveNavLink(entry.target.id);
                           }
                        }
                    }
                });
            };
            
            try {
                observer = new IntersectionObserver(observerCallback, observerOptions);
                sectionsForObserver.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) observer.observe(element);
                });
            } catch (e) {
                console.error("Failed to construct IntersectionObserver:", e);
            }
        }
        
        // --- Biblioteca Section Logic ---
        const dadosBiblioteca = [
             { 
                nome: "Creatina", 
                id: "creatina_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/E11D48/FFFFFF?text=Creatina", 
                htmlDetalhes: `<h3>O que é a Creatina?</h3> <p>A creatina é um aminoácido encontrado em alimentos como carnes e sintetizado no corpo. Essencial para energia muscular rápida.</p> <h4>Principais Benefícios</h4> <ul><li>Melhora do desempenho em exercícios de alta intensidade.</li><li>Aumento de força e massa muscular.</li></ul> <h4>Posologia Comum</h4> <p>Fase de saturação (opcional): 20g/dia por 5-7 dias. Manutenção: 3-5g/dia.</p> 
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Formas Comuns:</strong> Monohidratada (mais estudada e geralmente recomendada), HCL (cloridrato de creatina), Etil Éster, Alcalina.</p>
                                <p><strong>Mecanismo Simplificado:</strong> Aumenta os estoques de fosfocreatina nos músculos, o que ajuda a regenerar ATP (a principal molécula de energia celular) mais rapidamente durante exercícios de curta duração e alta intensidade.</p>
                                <p><strong>Efeitos Colaterais Potenciais:</strong> Desconforto gastrointestinal (especialmente em doses altas ou sem diluição adequada), cãibras musculares (se a hidratação não for adequada), retenção hídrica intramuscular inicial (pode levar a um pequeno aumento de peso). Geralmente é bem tolerada pela maioria dos indivíduos saudáveis.</p>
                                <p><strong>Precauções:</strong> Indivíduos com doença renal preexistente devem evitar ou usar com extrema cautela e sob supervisão médica. É crucial manter uma boa hidratação ao usar creatina.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde para informações completas e personalizadas.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Whey Protein", 
                id: "whey_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/BE123C/FFFFFF?text=Whey+Protein", 
                htmlDetalhes: `<h3>O que é o Whey Protein?</h3> <p>Proteína do soro do leite, rica em aminoácidos essenciais, especialmente BCAAs. Usada para recuperação e construção muscular.</p> <h4>Principais Benefícios</h4> <ul><li>Auxilia na hipertrofia muscular.</li><li>Melhora a recuperação pós-treino.</li></ul> <h4>Posologia Comum</h4> <p>20-40g pós-treino ou conforme necessidade proteica diária.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Tipos Comuns:</strong> Concentrado (WPC - contém lactose e gordura), Isolado (WPI - menor teor de lactose e gordura, maior concentração proteica), Hidrolisado (WPH - pré-digerido, absorção mais rápida).</p>
                                <p><strong>Velocidade de Absorção:</strong> Considerado uma proteína de rápida absorção, ideal para o pós-treino.</p>
                                <p><strong>Considerações para Intolerantes à Lactose:</strong> Whey Protein Isolado ou Hidrolisado são geralmente mais bem tolerados. Alternativas vegetais (soja, ervilha, arroz) também existem.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "BCAA", 
                id: "bcaa_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/9F1239/FFFFFF?text=BCAA", 
                htmlDetalhes: `<h3>O que são os BCAAs?</h3> <p>Aminoácidos de Cadeia Ramificada (Leucina, Isoleucina, Valina). Importantes para síntese proteica e energia muscular.</p> <h4>Principais Benefícios</h4> <ul><li>Podem reduzir a fadiga muscular.</li><li>Auxiliam na recuperação.</li></ul> <p><em>Nota: A suplementação isolada de BCAA pode não ser tão eficaz quanto proteínas completas para a síntese proteica máxima.</em></p> <h4>Posologia Comum</h4> <p>5-10g antes, durante ou após o treino.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Papel da Leucina:</strong> A leucina é considerada o principal BCAA na ativação da via mTOR, crucial para a síntese de proteínas musculares.</p>
                                <p><strong>Fontes Alimentares:</strong> Encontrados em abundância em alimentos ricos em proteínas como carnes, ovos, laticínios e leguminosas.</p>
                                <p><strong>Debate Científico:</strong> A suplementação isolada de BCAAs é controversa, com muitos estudos sugerindo que o consumo de proteínas completas (como whey protein ou fontes alimentares) é mais eficaz para a hipertrofia, pois fornece todos os aminoácidos essenciais.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Glutamina", 
                id: "glutamina_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/7F1D1D/FFFFFF?text=Glutamina", 
                htmlDetalhes: `<h3>O que é a Glutamina?</h3> <p>Aminoácido abundante no corpo, importante para o sistema imunológico e saúde intestinal, especialmente em períodos de estresse.</p> <h4>Principais Benefícios</h4> <ul><li>Suporte ao sistema imunológico.</li><li>Pode auxiliar na recuperação muscular e saúde intestinal.</li></ul> <h4>Posologia Comum</h4> <p>5-15g por dia, fracionados.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Aminoácido Condicionalmente Essencial:</strong> Em situações de estresse catabólico intenso (cirurgias, queimaduras, exercícios exaustivos), a demanda por glutamina pode exceder a capacidade de síntese do corpo.</p>
                                <p><strong>Saúde Intestinal:</strong> É um importante combustível para as células do intestino (enterócitos) e pode ajudar a manter a integridade da barreira intestinal.</p>
                                <p><strong>Uso em Atletas:</strong> Popular entre atletas para auxiliar na recuperação e reduzir o risco de infecções, embora a evidência para melhora de desempenho em indivíduos saudáveis seja mista.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "L-Carnitina", 
                id: "lcarnitina_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/881337/FFFFFF?text=L-Carnitina", 
                htmlDetalhes: `<h3>O que é a L-Carnitina?</h3> <p>Composto que auxilia no transporte de ácidos graxos para as mitocôndrias, onde são convertidos em energia.</p> <h4>Principais Benefícios</h4> <ul><li>Pode auxiliar no metabolismo de gorduras.</li><li>Pode melhorar o desempenho e recuperação em algumas situações.</li></ul> <h4>Posologia Comum</h4> <p>1-3g por dia.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Formas Comuns:</strong> L-Carnitina L-Tartarato (LCLT - comum em suplementos esportivos), Acetil-L-Carnitina (ALCAR - atravessa a barreira hematoencefálica, foco em saúde cerebral), Propionil-L-Carnitina (PLC - foco em circulação).</p>
                                <p><strong>Fontes Alimentares:</strong> Principalmente carnes vermelhas e laticínios.</p>
                                <p><strong>Eficácia na Perda de Peso:</strong> A evidência científica sobre a eficácia da L-Carnitina para perda de peso em indivíduos saudáveis é mista e não conclusiva. Pode ser mais benéfica em indivíduos com deficiência ou em contextos específicos.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Beta-Alanina", 
                id: "betaalanina_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/e0f2f7/374151?text=Beta-Alanina", 
                htmlDetalhes: `<h3>O que é a Beta-Alanina?</h3> <p>Aminoácido que aumenta os níveis de carnosina muscular, ajudando a tamponar a acidez e retardar a fadiga.</p> <h4>Principais Benefícios</h4> <ul><li>Melhora o desempenho em exercícios de alta intensidade (1-4 minutos).</li><li>Reduz a fadiga muscular.</li></ul> <h4>Posologia Comum</h4> <p>3-6g por dia, fracionados para evitar parestesia (formigamento).</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Mecanismo de Ação:</strong> A beta-alanina combina-se com a histidina para formar carnosina nos músculos. A carnosina atua como um tampão intramuscular, neutralizando íons de hidrogênio (H+) que se acumulam durante exercícios intensos e contribuem para a fadiga.</p>
                                <p><strong>Parestesia:</strong> É uma sensação de formigamento na pele, comum após a ingestão de beta-alanina. É inofensiva e pode ser minimizada dividindo a dose diária em porções menores ou usando fórmulas de liberação prolongada.</p>
                                <p><strong>Tempo para Efeito:</strong> Os benefícios da beta-alanina são cumulativos e geralmente levam algumas semanas de suplementação para se tornarem evidentes, à medida que os níveis de carnosina muscular aumentam.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Arginina", 
                id: "arginina_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fecdd3/374151?text=Arginina", 
                htmlDetalhes: `<h3>O que é a Arginina?</h3> <p>Aminoácido precursor do óxido nítrico (NO), que promove vasodilatação e melhora o fluxo sanguíneo.</p> <h4>Principais Benefícios</h4> <ul><li>Pode melhorar o fluxo sanguíneo e entrega de nutrientes.</li><li>Potencial para melhora de desempenho em alguns casos.</li></ul> <h4>Posologia Comum</h4> <p>3-6g antes do treino.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Óxido Nítrico (NO):</strong> O NO é uma molécula sinalizadora que relaxa os vasos sanguíneos, melhorando a circulação e o "pump" muscular durante o exercício.</p>
                                <p><strong>Outros Usos Potenciais:</strong> Pesquisada para condições relacionadas à circulação, cicatrização e função imunológica. No entanto, a suplementação oral de arginina pode ter biodisponibilidade limitada devido ao metabolismo no fígado.</p>
                                <p><strong>Alternativas:</strong> A citrulina (outro aminoácido) é convertida em arginina no corpo e pode ser mais eficaz para aumentar os níveis de arginina plasmática do que a própria arginina.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Ômega 3", 
                id: "omega3_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fee2e2/374151?text=Ômega+3", 
                htmlDetalhes: `<h3>O que é o Ômega 3?</h3> <p>Ácidos graxos essenciais (EPA e DHA) com propriedades anti-inflamatórias, importantes para saúde cardiovascular e cerebral.</p> <h4>Principais Benefícios</h4> <ul><li>Saúde cardiovascular.</li><li>Função cerebral e visual.</li><li>Ação anti-inflamatória.</li></ul> <h4>Posologia Comum</h4> <p>1-3g de EPA+DHA combinados por dia.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Tipos Principais:</strong> EPA (ácido eicosapentaenoico) e DHA (ácido docosahexaenoico) são encontrados em peixes gordurosos e algas. ALA (ácido alfa-linolênico) é encontrado em fontes vegetais (linhaça, chia, nozes) e tem conversão limitada para EPA/DHA no corpo.</p>
                                <p><strong>Fontes:</strong> Salmão, cavala, sardinha, arenque, óleo de peixe, óleo de krill, óleo de algas (para veganos).</p>
                                <p><strong>Considerações:</strong> A qualidade do suplemento é importante (pureza, ausência de contaminantes como mercúrio). Pode interagir com medicamentos anticoagulantes em doses elevadas.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Cafeína", 
                id: "cafeina_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fecdd3/374151?text=Cafeína", 
                htmlDetalhes: `<h3>O que é a Cafeína?</h3> <p>Estimulante do sistema nervoso central que aumenta o alerta, foco e pode melhorar o desempenho físico.</p> <h4>Principais Benefícios</h4> <ul><li>Aumento de energia e alerta.</li><li>Melhora do desempenho físico e mental.</li></ul> <h4>Posologia Comum</h4> <p>100-400mg, 30-60 minutos antes do exercício ou conforme necessidade. Evitar altas doses e uso tardio.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Mecanismo de Ação:</strong> Principalmente bloqueando os receptores de adenosina no cérebro, um neurotransmissor que promove o relaxamento e sonolência.</p>
                                <p><strong>Tolerância e Abstinência:</strong> O uso regular pode levar à tolerância, necessitando doses maiores para o mesmo efeito. A interrupção abrupta pode causar sintomas de abstinência (dor de cabeça, fadiga).</p>
                                <p><strong>Sensibilidade Individual:</strong> A resposta à cafeína varia muito entre as pessoas devido a fatores genéticos. Doses elevadas podem causar ansiedade, insônia e palpitações em indivíduos sensíveis.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Multivitamínico", 
                id: "multivitaminico_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fecdd3/374151?text=Multivitamínico", 
                htmlDetalhes: `<h3>O que é um Multivitamínico?</h3> <p>Suplemento que combina diversas vitaminas e minerais essenciais para complementar a dieta e prevenir deficiências.</p> <h4>Principais Benefícios</h4> <ul><li>Ajuda a suprir lacunas nutricionais.</li><li>Suporte geral à saúde.</li></ul> <h4>Posologia Comum</h4> <p>Conforme rótulo do produto. Idealmente com orientação profissional.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Propósito:</strong> Destina-se a preencher possíveis lacunas nutricionais na dieta, não a substituir uma alimentação equilibrada e variada.</p>
                                <p><strong>Considerações:</strong> A composição varia muito entre produtos. Algumas formulações são específicas para gênero, idade ou necessidades especiais. Doses excessivas de certas vitaminas (especialmente as lipossolúveis como A, D, E, K) podem ser tóxicas.</p>
                                <p><strong>Qualidade:</strong> A biodisponibilidade dos nutrientes pode variar. Escolher marcas com boa reputação e, se possível, certificações de terceiros.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Probióticos", 
                id: "probioticos_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fbcfe8/374151?text=Probióticos", 
                htmlDetalhes: `<h3>O que são Probióticos?</h3> <p>Microrganismos vivos que, administrados em quantidades adequadas, conferem benefícios à saúde, especialmente intestinal.</p> <h4>Principais Benefícios</h4> <ul><li>Saúde digestiva e intestinal.</li><li>Fortalecimento do sistema imunológico.</li></ul> <h4>Posologia Comum</h4> <p>Varia conforme a cepa e o produto. Seguir recomendação do fabricante ou profissional.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Especificidade da Cepa:</strong> Os efeitos dos probióticos são específicos da cepa (ex: <em>Lactobacillus rhamnosus GG</em>, <em>Bifidobacterium lactis BB-12</em>). Diferentes cepas têm diferentes benefícios.</p>
                                <p><strong>Contagem de UFC (Unidades Formadoras de Colônias):</strong> Indica a quantidade de bactérias vivas. Doses eficazes variam, mas geralmente estão na faixa de bilhões de UFCs.</p>
                                <p><strong>Prebióticos:</strong> São fibras não digeríveis que servem de alimento para os probióticos, ajudando-os a proliferar. Suplementos simbióticos contêm tanto probióticos quanto prebióticos.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Fibras Dietéticas", 
                id: "fibras_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fee2e2/374151?text=Fibras", 
                htmlDetalhes: `<h3>O que são Fibras Dietéticas?</h3> <p>Componentes de alimentos vegetais não digeríveis, importantes para a saúde digestiva, saciedade e controle glicêmico.</p> <h4>Principais Benefícios</h4> <ul><li>Melhora o trânsito intestinal.</li><li>Aumenta a saciedade.</li><li>Auxilia no controle do colesterol e glicemia.</li></ul> <h4>Recomendação</h4> <p>Aumentar o consumo através de frutas, vegetais, leguminosas e grãos integrais. Suplementos podem complementar.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Tipos:</strong> Solúveis (formam gel em água, ex: aveia, psyllium, pectina) e Insolúveis (aumentam o bolo fecal, ex: farelo de trigo, cascas de vegetais).</p>
                                <p><strong>Recomendação Diária:</strong> Geralmente entre 25-38 gramas por dia para adultos, dependendo da idade e sexo.</p>
                                <p><strong>Importância da Água:</strong> É crucial aumentar a ingestão de água ao aumentar o consumo de fibras para evitar constipação e desconforto.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Colágeno", 
                id: "colageno_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/ffe4e6/374151?text=Colágeno", 
                htmlDetalhes: `<h3>O que é o Colágeno?</h3> <p>Proteína estrutural fundamental para pele, articulações, ossos e tecidos conjuntivos.</p> <h4>Principais Benefícios</h4> <ul><li>Pode melhorar a saúde da pele e elasticidade.</li><li>Suporte à saúde articular.</li></ul> <h4>Posologia Comum</h4> <p>Varia conforme o tipo (hidrolisado, tipo II). Geralmente 2.5-15g/dia para colágeno hidrolisado.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Tipos Principais:</strong> Tipo I (pele, ossos, tendões), Tipo II (cartilagem articular), Tipo III (pele, vasos sanguíneos). Suplementos geralmente focam em colágeno hidrolisado (peptídeos de colágeno) para pele e Tipo II não desnaturado para articulações.</p>
                                <p><strong>Fontes:</strong> Caldo de ossos, gelatina. Suplementos são derivados de fontes bovinas, suínas, marinhas ou de frango.</p>
                                <p><strong>Vitamina C:</strong> Essencial para a síntese de colágeno no corpo. Alguns suplementos de colágeno incluem vitamina C.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Vitamina D", 
                id: "vitaminad_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/ffe4b5/374151?text=Vitamina+D", 
                htmlDetalhes: `<h3>O que é a Vitamina D?</h3> <p>Vitamina lipossolúvel essencial para absorção de cálcio, saúde óssea, função imunológica e muscular.</p> <h4>Principais Benefícios</h4> <ul><li>Saúde óssea e dental.</li><li>Fortalecimento do sistema imunológico.</li></ul> <h4>Posologia Comum</h4> <p>Varia conforme níveis sanguíneos e orientação profissional. Exposição solar é a principal fonte.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Formas:</strong> D2 (ergocalciferol - origem vegetal) e D3 (colecalciferol - origem animal e produzida na pele pela exposição solar). A D3 é geralmente considerada mais eficaz em aumentar os níveis sanguíneos.</p>
                                <p><strong>Importância dos Testes:</strong> A deficiência é comum. Exames de sangue (25-hidroxivitamina D) podem determinar a necessidade de suplementação e a dose adequada.</p>
                                <p><strong>Sintomas de Deficiência (podem ser sutis):</strong> Fadiga, dor óssea, fraqueza muscular, maior susceptibilidade a infecções.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Magnésio", 
                id: "magnesio_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fee2e2/374151?text=Magnésio", 
                htmlDetalhes: `<h3>O que é o Magnésio?</h3> <p>Mineral essencial envolvido em centenas de reações enzimáticas, importante para função muscular, nervosa, energia e saúde óssea.</p> <h4>Principais Benefícios</h4> <ul><li>Saúde muscular e nervosa.</li><li>Produção de energia.</li><li>Pode auxiliar no sono e relaxamento.</li></ul> <h4>Posologia Comum</h4> <p>200-400mg por dia, dependendo da forma e necessidade.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Formas Comuns:</strong> Citrato de magnésio (boa biodisponibilidade, pode ter efeito laxativo), Glicinato/Bisglicinato de magnésio (alta biodisponibilidade, menos laxativo), Óxido de magnésio (menor biodisponibilidade, mais laxativo), Malato de magnésio (pode ajudar com energia e dor muscular).</p>
                                <p><strong>Fontes Alimentares:</strong> Vegetais de folhas escuras, nozes, sementes, grãos integrais, leguminosas.</p>
                                <p><strong>Deficiência:</strong> Pode ocorrer devido à dieta inadequada, certas condições médicas ou medicamentos. Sintomas podem incluir cãibras, fadiga, irritabilidade.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Carotenoides", 
                id: "carotenoides_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fecba1/374151?text=Carotenoides", 
                htmlDetalhes: `<h3>O que são Carotenoides?</h3> <p>Pigmentos vegetais (ex: betacaroteno, luteína, licopeno) com potente ação antioxidante. Alguns são precursores da Vitamina A.</p> <h4>Principais Benefícios</h4> <ul><li>Ação antioxidante.</li><li>Saúde ocular e da pele.</li></ul> <h4>Recomendação</h4> <p>Obtidos através de dieta rica em frutas e vegetais coloridos.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Exemplos Específicos:</strong> Betacaroteno (cenoura, abóbora - precursor da Vitamina A), Luteína e Zeaxantina (vegetais de folhas verdes, milho, gema de ovo - saúde ocular), Licopeno (tomate, melancia - antioxidante, saúde da próstata).</p>
                                <p><strong>Absorção:</strong> São lipossolúveis, o que significa que sua absorção é melhorada quando consumidos com alguma gordura.</p>
                                <p><strong>Suplementação vs. Dieta:</strong> Geralmente, obter carotenoides através de uma dieta variada é preferível à suplementação isolada, exceto em casos específicos orientados por profissionais.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Fitosteróis", 
                id: "fitosterois_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fee2e2/374151?text=Fitosteróis", 
                htmlDetalhes: `<h3>O que são Fitosteróis?</h3> <p>Compostos vegetais estruturalmente similares ao colesterol, que ajudam a reduzir a absorção de colesterol no intestino.</p> <h4>Principais Benefícios</h4> <ul><li>Auxiliam na redução do colesterol LDL ("ruim").</li></ul> <h4>Posologia Comum</h4> <p>1-3g por dia, geralmente via alimentos enriquecidos ou suplementos.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Mecanismo de Ação:</strong> Competem com o colesterol pela absorção no intestino, resultando em menor absorção de colesterol dietético e biliar.</p>
                                <p><strong>Fontes Alimentares:</strong> Óleos vegetais, nozes, sementes, grãos. Alimentos enriquecidos (margarinas, iogurtes) são uma forma comum de aumentar a ingestão.</p>
                                <p><strong>Considerações:</strong> Podem reduzir ligeiramente a absorção de vitaminas lipossolúveis (como carotenoides), mas geralmente não é um problema significativo com dietas equilibradas.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Coenzima Q10", 
                id: "coq10_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fca5a5/374151?text=CoQ10", 
                htmlDetalhes: `<h3>O que é a Coenzima Q10?</h3> <p>Substância similar a uma vitamina, essencial para produção de energia celular (ATP) e com forte ação antioxidante.</p> <h4>Principais Benefícios</h4> <ul><li>Produção de energia celular.</li><li>Ação antioxidante.</li><li>Pode beneficiar a saúde cardiovascular.</li></ul> <h4>Posologia Comum</h4> <p>100-200mg por dia. Usuários de estatinas podem necessitar mais.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Formas:</strong> Ubiquinona (forma oxidada, mais comum em suplementos e precisa ser convertida no corpo) e Ubiquinol (forma reduzida, ativa, pode ser mais biodisponível, especialmente para indivíduos mais velhos).</p>
                                <p><strong>Produção Corporal:</strong> Produzida naturalmente pelo corpo, mas os níveis podem diminuir com a idade e devido a certas condições ou medicamentos (como estatinas).</p>
                                <p><strong>Fontes Alimentares:</strong> Carnes (especialmente órgãos como coração e fígado), peixes gordurosos, nozes e sementes.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Resveratrol", 
                id: "resveratrol_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fda4af/374151?text=Resveratrol", 
                htmlDetalhes: `<h3>O que é o Resveratrol?</h3> <p>Polifenol encontrado em uvas vermelhas e outras plantas, conhecido por suas propriedades antioxidantes e anti-inflamatórias.</p> <h4>Principais Benefícios</h4> <ul><li>Potente ação antioxidante.</li><li>Pode apoiar a saúde cardiovascular e metabólica.</li></ul> <h4>Posologia Comum</h4> <p>Doses variam, geralmente 100-500mg de trans-resveratrol.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Fontes:</strong> Casca de uvas vermelhas (e vinho tinto), frutas vermelhas (mirtilos, cranberries), amendoim, chocolate amargo.</p>
                                <p><strong>Forma Ativa:</strong> O trans-resveratrol é a forma mais biologicamente ativa e estudada.</p>
                                <p><strong>Pesquisa:</strong> Extensivamente pesquisado por seus potenciais benefícios antienvelhecimento e na prevenção de doenças crônicas, mas muitos estudos são em animais ou in vitro. Mais pesquisas em humanos são necessárias para confirmar muitos dos efeitos.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Triptofano", 
                id: "triptofano_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/bae6fd/374151?text=Triptofano", 
                htmlDetalhes: `<h3>O que é o Triptofano?</h3> <p>Aminoácido essencial precursor da serotonina (neurotransmissor do bem-estar) e melatonina (hormônio do sono).</p> <h4>Principais Benefícios</h4> <ul><li>Pode melhorar o humor.</li><li>Auxilia na regulação do sono.</li><li>Pode ajudar a controlar o apetite.</li></ul> <h4>Posologia Comum</h4> <p>500mg a 2g por dia, preferencialmente antes de dormir ou conforme orientação.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Fontes Alimentares:</strong> Peru, frango, ovos, queijo, nozes, sementes, aveia, banana.</p>
                                <p><strong>Conversão:</strong> A conversão de triptofano em serotonina no cérebro depende da disponibilidade de outros nutrientes (vitaminas do complexo B, magnésio) e da competição com outros aminoácidos na barreira hematoencefálica.</p>
                                <p><strong>5-HTP:</strong> O 5-hidroxitriptofano é um metabólito intermediário na conversão de triptofano para serotonina e também é vendido como suplemento.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Ashwagandha", 
                id: "ashwagandha_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/d4d4d8/374151?text=Ashwagandha", 
                htmlDetalhes: `<h3>O que é a Ashwagandha?</h3> <p>Planta adaptógena usada na medicina Ayurveda para ajudar o corpo a lidar com o estresse e promover vitalidade.</p> <h4>Principais Benefícios</h4> <ul><li>Redução do estresse e ansiedade.</li><li>Melhora da energia e resistência.</li><li>Pode apoiar a função cognitiva.</li></ul> <h4>Posologia Comum</h4> <p>300-600mg de extrato padronizado por dia.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Nome Científico:</strong> <em>Withania somnifera</em>.</p>
                                <p><strong>Adaptógeno:</strong> Ajuda o corpo a se adaptar a vários tipos de estresse (físico, químico, biológico), normalizando funções fisiológicas.</p>
                                <p><strong>Compostos Ativos:</strong> Withanolídeos são os principais compostos bioativos responsáveis por muitos dos seus efeitos.</p>
                                <p><strong>Precauções:</strong> Pode interagir com medicamentos sedativos, imunossupressores e para tireoide. Evitar na gravidez.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Rhodiola Rosea", 
                id: "rhodiola_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fde68a/374151?text=Rhodiola", 
                htmlDetalhes: `<h3>O que é a Rhodiola Rosea?</h3> <p>Planta adaptógena que cresce em regiões frias, conhecida por combater a fadiga e melhorar o desempenho mental e físico.</p> <h4>Principais Benefícios</h4> <ul><li>Redução da fadiga mental e física.</li><li>Melhora da concentração e humor.</li><li>Aumento da resistência ao estresse.</li></ul> <h4>Posologia Comum</h4> <p>200-600mg de extrato padronizado (ex: 3% rosavinas, 1% salidrosídeos) por dia.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Compostos Ativos:</strong> Rosavinas e salidrosídeos são os principais compostos bioativos.</p>
                                <p><strong>Uso Tradicional:</strong> Usada há séculos na Rússia e Escandinávia para aumentar a resistência física e a longevidade, e para tratar fadiga e depressão.</p>
                                <p><strong>Considerações:</strong> Pode causar insônia leve ou agitação em algumas pessoas se tomada no final do dia. Geralmente bem tolerada.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Cúrcuma (Curcumina)", 
                id: "curcuma_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/f59e0b/FFFFFF?text=Cúrcuma", 
                htmlDetalhes: `<h3>O que é a Cúrcuma (Curcumina)?</h3> <p>Especiaria amarela vibrante, cujo principal composto ativo é a curcumina, com potentes efeitos anti-inflamatórios e antioxidantes.</p> <h4>Principais Benefícios</h4> <ul><li>Forte ação anti-inflamatória.</li><li>Poderoso antioxidante.</li><li>Pode melhorar a saúde articular e cerebral.</li></ul> <h4>Posologia Comum</h4> <p>500-2000mg de curcumina por dia, frequentemente combinada com piperina (pimenta preta) para melhor absorção.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Biodisponibilidade:</strong> A curcumina por si só tem baixa biodisponibilidade. Combiná-la com piperina (extrato de pimenta preta) ou formulá-la com lipídios pode aumentar significativamente sua absorção.</p>
                                <p><strong>Mecanismo Anti-inflamatório:</strong> Atua em múltiplas vias inflamatórias, incluindo a inibição do NF-kB, uma molécula chave na inflamação.</p>
                                <p><strong>Precauções:</strong> Em doses muito altas, pode causar desconforto gastrointestinal. Pode interagir com medicamentos anticoagulantes.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Gengibre", 
                id: "gengibre_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fcd34d/374151?text=Gengibre", 
                htmlDetalhes: `<h3>O que é o Gengibre?</h3> <p>Raiz com propriedades anti-inflamatórias, antioxidantes e digestivas. Usado para aliviar náuseas e dores.</p> <h4>Principais Benefícios</h4> <ul><li>Alívio de náuseas e vômitos.</li><li>Ação anti-inflamatória e analgésica.</li><li>Melhora da digestão.</li></ul> <h4>Posologia Comum</h4> <p>Variável. Em pó: 1-3g por dia. Extratos concentrados conforme orientação.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Nome Científico:</strong> <em>Zingiber officinale</em>.</p>
                                <p><strong>Compostos Ativos:</strong> Gingeróis e shogaóis são os principais compostos bioativos responsáveis por seus efeitos.</p>
                                <p><strong>Uso para Náuseas:</strong> Particularmente eficaz para náuseas relacionadas à gravidez (enjoo matinal), enjoo de movimento e pós-operatório.</p>
                                <p><strong>Precauções:</strong> Em doses elevadas, pode causar azia ou interagir com anticoagulantes.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Tribulus Terrestris", 
                id: "tribulus_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/a3e635/374151?text=Tribulus", 
                htmlDetalhes: `<h3>O que é o Tribulus Terrestris?</h3> <p>Planta usada tradicionalmente para aumentar a libido e, possivelmente, os níveis de testosterona (evidências mistas).</p> <h4>Principais Benefícios</h4> <ul><li>Pode aumentar a libido e função sexual.</li><li>Potencial suporte à vitalidade (mais estudos são necessários).</li></ul> <h4>Posologia Comum</h4> <p>250-1500mg por dia, dependendo da concentração de saponinas.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Compostos Ativos:</strong> Saponinas esteroidais, como a protodioscina, são consideradas os principais componentes ativos.</p>
                                <p><strong>Efeito na Testosterona:</strong> A pesquisa sobre o efeito do Tribulus nos níveis de testosterona em humanos é inconsistente. Alguns estudos mostram benefícios, especialmente em indivíduos com baixos níveis, enquanto outros não encontram efeitos significativos.</p>
                                <p><strong>Uso Tradicional:</strong> Usado na medicina tradicional chinesa e ayurvédica para diversas finalidades, incluindo saúde urinária e sexual.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Valeriana", 
                id: "valeriana_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/c084fc/FFFFFF?text=Valeriana", 
                htmlDetalhes: `<h3>O que é a Valeriana?</h3> <p>Planta medicinal conhecida por suas propriedades calmantes e sedativas, usada para insônia e ansiedade.</p> <h4>Principais Benefícios</h4> <ul><li>Promove o relaxamento e melhora a qualidade do sono.</li><li>Pode reduzir a ansiedade leve.</li></ul> <h4>Posologia Comum</h4> <p>300-600mg de extrato de raiz, 30-60 minutos antes de dormir.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Nome Científico:</strong> <em>Valeriana officinalis</em>.</p>
                                <p><strong>Mecanismo de Ação (Proposto):</strong> Acredita-se que interaja com o sistema GABA (ácido gama-aminobutírico), um neurotransmissor inibitório no cérebro, promovendo relaxamento.</p>
                                <p><strong>Formas de Uso:</strong> Chá, tintura, extrato seco em cápsulas ou comprimidos.</p>
                                <p><strong>Precauções:</strong> Pode causar sonolência; evitar dirigir ou operar máquinas pesadas após o uso. Não combinar com álcool ou outros sedativos sem orientação médica.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Vitamina K2", 
                id: "vitaminaK2_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/86efac/374151?text=Vitamina+K2", 
                htmlDetalhes: `<h3>O que é a Vitamina K2?</h3> <p>Vitamina lipossolúvel crucial para a saúde óssea (direciona o cálcio para os ossos) e cardiovascular (previne calcificação arterial).</p> <h4>Principais Benefícios</h4> <ul><li>Saúde óssea e prevenção de osteoporose.</li><li>Saúde cardiovascular.</li></ul> <h4>Posologia Comum</h4> <p>100-200mcg por dia (especialmente na forma MK-7).</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Formas:</strong> MK-4 (menaquinona-4) e MK-7 (menaquinona-7) são as formas mais importantes. MK-7 tem uma meia-vida mais longa no corpo.</p>
                                <p><strong>Sinergia:</strong> Trabalha em conjunto com a Vitamina D e o Cálcio para a saúde óssea. A Vitamina D aumenta a absorção de cálcio, e a K2 ajuda a direcionar esse cálcio para os ossos e dentes, em vez de se depositar nas artérias.</p>
                                <p><strong>Fontes Alimentares:</strong> Alimentos fermentados (natto é uma fonte rica de MK-7), queijos curados, gema de ovo, fígado.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
            { 
                nome: "Vitamina C", 
                id: "vitaminaC_bib", 
                imagemPlaceholder: "https://placehold.co/600x400/fdba74/374151?text=Vitamina+C", 
                htmlDetalhes: `<h3>O que é a Vitamina C?</h3> <p>Poderoso antioxidante hidrossolúvel, essencial para o sistema imunológico, produção de colágeno e absorção de ferro.</p> <h4>Principais Benefícios</h4> <ul><li>Fortalecimento do sistema imunológico.</li><li>Ação antioxidante.</li><li>Saúde da pele e cicatrização.</li></ul> <h4>Posologia Comum</h4> <p>500-2000mg por dia. Doses maiores podem ser usadas em certas condições, com orientação.</p>
                                <h4>Informações Adicionais Geradas</h4>
                                <p><strong>Formas Comuns:</strong> Ácido ascórbico (forma mais comum), ascorbatos minerais (ex: ascorbato de sódio, ascorbato de cálcio - podem ser menos ácidos e mais suaves para o estômago).</p>
                                <p><strong>Fontes Alimentares:</strong> Frutas cítricas (laranja, limão), kiwi, morango, pimentão, brócolis, tomate.</p>
                                <p><strong>Considerações:</strong> Doses muito altas podem causar desconforto gastrointestinal ou diarreia. Pessoas com certas condições (como hemocromatose) devem ter cautela.</p>
                                <p class="text-xs italic mt-2"><em>Fonte da Informação Adicional: Gerado por IA para fins ilustrativos. Consulte fontes científicas e profissionais de saúde.</em></p>
                                <div class="disclaimer-box-strong-custom mt-8"> <p>Consulte um profissional de saúde.</p> </div>` 
            },
        ].map(sup => {
            const encodedName = encodeURIComponent(sup.nome);
            // REMOVED: const anvisaMsSearchUrl = `https://www.google.com/search?q=site%3Aanvisa.gov.br+OR+site%3Asaude.gov.br+"${encodedName}"+informa%C3%A7%C3%B5es+suplemento`;
            // REMOVED: const anvisaIN28Url = `https://www.anvisa.gov.br/legis/#/visualizar/409857`; 
            // REMOVED: const msSearchUrl = `https://www.google.com/search?q=site%3Asaude.gov.br+OR+site%3Agov.br/saude+"${encodedName}"+suplemento`;

            // REMOVED: const officialSourceButtons = `...`; // This whole block is removed
            return {
                ...sup, 
                colors: extractColorsFromPlaceholder(sup.imagemPlaceholder),
                // htmlDetalhes: sup.htmlDetalhes + officialSourceButtons // REMOVED: Button appending
                htmlDetalhes: sup.htmlDetalhes // Keep original details + AI generated info
            };
        });

        const bibliotecaGrid = document.getElementById('biblioteca-grid');
        const bibliotecaDetalhesContainer = document.getElementById('biblioteca-detalhes-container');

        function renderBiblioteca() {
            bibliotecaGrid.innerHTML = '';
            dadosBiblioteca.forEach(sup => {
                const card = document.createElement('div');
                card.className = 'biblioteca-suplemento-card';
                card.addEventListener('click', () => showSuplementoDetalhes(sup, 'biblioteca'));
                card.innerHTML = `
                    <div class="biblioteca-suplemento-card-inner">
                        <h3 class="biblioteca-suplemento-card-title">${sup.nome}</h3>
                    </div>
                `;
                bibliotecaGrid.appendChild(card);
            });
        }

        async function adicionarAoCatalogoPessoal(suplementoDaBiblioteca) {
            if (!fbDb || !currentUserId) {
                showNotification("Funcionalidade indisponível. Faça login ou tente mais tarde.", "error");
                return;
            }
            const suplementoNome = suplementoDaBiblioteca.nome;
            const suplementosCollRef = collection(fbDb, suplementosPessoaisCollectionPath);
            const q = query(suplementosCollRef, where("nome", "==", suplementoNome));

            try {
                const querySnapshot = await getDocs(q);
                if (!querySnapshot.empty) {
                    showNotification(`"${suplementoNome}" já existe no seu Catálogo Pessoal.`, "info");
                    return;
                }

                const dataToSave = {
                    nome: suplementoNome,
                    imagemPlaceholder: suplementoDaBiblioteca.imagemPlaceholder, 
                    principiosAtivos: "", 
                    formaDeUso: `Adicionado da biblioteca. Detalhes completos disponíveis na seção Biblioteca. Edite para adicionar suas notas pessoais.`,
                    adicionadoEm: new Date().toISOString(),
                    detalhesImportados: suplementoDaBiblioteca.htmlDetalhes 
                };

                await addDoc(suplementosCollRef, dataToSave);
                showNotification(`"${suplementoNome}" adicionado ao Catálogo Pessoal!`, "success");

            } catch (error) {
                console.error("Erro ao adicionar ao catálogo pessoal:", error);
                showNotification("Erro ao adicionar suplemento: " + error.message, "error");
            }
        }
        
        async function excluirDoCatalogoPessoal(suplementoId, suplementoNome) {
            if (!fbDb || !currentUserId) {
                showNotification("Funcionalidade indisponível.", "error");
                return;
            }
            
            showConfirmationModal(
                "Excluir Suplemento",
                `Tem certeza que deseja excluir "${suplementoNome}" do seu catálogo pessoal? Esta ação não pode ser desfeita.`,
                async () => {
                    try {
                        const docRef = doc(fbDb, suplementosPessoaisCollectionPath, suplementoId);
                        await deleteDoc(docRef);
                        showNotification(`"${suplementoNome}" excluído com sucesso!`, "success");
                        hideSuplementoDetalhes('catalogoPessoal'); 
                    } catch (error) {
                        console.error("Erro ao excluir do catálogo pessoal:", error);
                        showNotification("Erro ao excluir suplemento: " + error.message, "error");
                    }
                }
            );
        }


        function showSuplementoDetalhes(suplemento, sectionOrigin) {
            const container = sectionOrigin === 'biblioteca' ? bibliotecaDetalhesContainer : document.getElementById('catalogo-pessoal-detalhes-container');
            const gridOrGridContainer = sectionOrigin === 'biblioteca' ? bibliotecaGrid : document.getElementById('catalogo-pessoal-grid-container');
            
            if (!container || !gridOrGridContainer) return;

            gridOrGridContainer.style.display = 'none';

            let actionButtonHTML = '';
            if (sectionOrigin === 'biblioteca') {
                actionButtonHTML = `
                    <button id="add-to-personal-catalog-btn" class="cta-button-custom !bg-green-600 hover:!bg-green-700 mt-6 w-full sm:w-auto">
                        ${iconSVG.plus.replace('class="', 'class="mr-2 inline "')}
                        Adicionar ao Catálogo Pessoal
                    </button>`;
            } else if (sectionOrigin === 'catalogoPessoal' && suplemento.id) { 
                 actionButtonHTML = `
                    <button id="delete-from-personal-catalog-btn" class="cta-button-custom !bg-red-700 hover:!bg-red-800 mt-6 w-full sm:w-auto">
                        ${iconSVG.trash2.replace('class="', 'class="mr-2 inline "')}
                        Excluir do Catálogo
                    </button>`;
            }


            let detailsLayoutHTML = '';
            if (sectionOrigin === 'biblioteca') {
                detailsLayoutHTML = `
                    <div class="md:col-span-3 text-slate-700 leading-relaxed">
                        ${suplemento.htmlDetalhes || "<p>Informações detalhadas não disponíveis.</p>"}
                        <div class="mt-6"> ${actionButtonHTML} </div>
                    </div>
                `;
            } else { 
                detailsLayoutHTML = `
                    <div class="md:col-span-1">
                        ${suplemento.imagemPlaceholder ? `
                        <img 
                            src="${suplemento.imagemPlaceholder || 'https://placehold.co/500x667/cccccc/333333?text=Imagem+Indispon%C3%ADvel'}" 
                            alt="Imagem de ${suplemento.nome}"
                            class="rounded-xl shadow-lg mb-6 w-full object-cover aspect-[3/4]"
                            onerror="this.onerror=null; this.src='https://placehold.co/500x667/cccccc/333333?text=Imagem+Indispon%C3%ADvel';"
                        />` : ''}
                        <div class="disclaimer-box-custom">
                            <p class="font-semibold">Lembre-se:</p>
                            <p>Este conteúdo é informativo. Consulte um profissional de saúde.</p>
                        </div>
                        ${actionButtonHTML}
                    </div>
                    <div class="md:col-span-2 text-slate-700 leading-relaxed">
                        ${suplemento.principiosAtivos ? `<h3>Princípios Ativos</h3><p class="whitespace-pre-line">${suplemento.principiosAtivos}</p>` : ''}
                        ${suplemento.formaDeUso ? `<h3 class="mt-6">Forma de Uso Recomendada</h3><p class="whitespace-pre-line">${suplemento.formaDeUso}</p>` : ''}
                        ${!suplemento.principiosAtivos && !suplemento.formaDeUso && !suplemento.detalhesImportados ? '<p>Informações detalhadas não disponíveis para este suplemento. Adicione manualmente ou edite para incluir.</p>' : ''}
                        ${suplemento.detalhesImportados ? `<h3>Detalhes Importados da Biblioteca</h3><div class="prose-gemini">${suplemento.detalhesImportados}</div>` : ''}
                    </div>
                `;
            }


            container.innerHTML = `
                <div class="suplemento-detalhe-content-custom">
                    <button id="voltar-${sectionOrigin}-btn" class="voltar-catalogo-btn-custom">
                        ${iconSVG.chevronDown.replace('class="', 'class="mr-2.5 h-5 w-5 transform -rotate-90 ')}
                        Voltar à ${sectionOrigin === 'biblioteca' ? 'Biblioteca' : 'Catálogo Pessoal'}
                    </button>
                    <div class="suplemento-detalhe-header-block-custom" style="background-color: ${suplemento.colors?.bgColor || '#E11D48'}">
                        <h2 style="color: ${suplemento.colors?.textColor || '#FFFFFF'}">${suplemento.nome}</h2>
                    </div>
                    <div class="content-box-custom">
                        <div class="grid ${sectionOrigin === 'biblioteca' ? 'md:grid-cols-1' : 'md:grid-cols-3'} gap-x-10 gap-y-8">
                            ${detailsLayoutHTML}
                        </div>
                    </div>
                </div>
            `;
            container.style.display = 'block';
            document.getElementById(`voltar-${sectionOrigin}-btn`).addEventListener('click', () => hideSuplementoDetalhes(sectionOrigin));
            
            if (sectionOrigin === 'biblioteca') {
                const addButton = document.getElementById('add-to-personal-catalog-btn');
                if (addButton) {
                    addButton.addEventListener('click', () => adicionarAoCatalogoPessoal(suplemento));
                }
            } else if (sectionOrigin === 'catalogoPessoal' && suplemento.id) {
                const deleteButton = document.getElementById('delete-from-personal-catalog-btn');
                if (deleteButton) {
                    deleteButton.addEventListener('click', () => excluirDoCatalogoPessoal(suplemento.id, suplemento.nome));
                }
            }
            
            setTimeout(() => {
                const elementPosition = container.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerHeight;
                window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
            }, 100);
        }

        function hideSuplementoDetalhes(sectionOrigin) {
            const container = sectionOrigin === 'biblioteca' ? bibliotecaDetalhesContainer : document.getElementById('catalogo-pessoal-detalhes-container');
            const gridOrGridContainer = sectionOrigin === 'biblioteca' ? bibliotecaGrid : document.getElementById('catalogo-pessoal-grid-container');
            const sectionElement = document.getElementById(sectionOrigin);

            if (!container || !gridOrGridContainer || !sectionElement) return;

            container.style.display = 'none';
            container.innerHTML = '';
            
            if (sectionOrigin === 'biblioteca') {
                gridOrGridContainer.style.display = 'grid';
            } else { 
                gridOrGridContainer.style.display = 'block'; 
                document.getElementById('catalogo-pessoal-grid').style.display = document.getElementById('catalogo-pessoal-grid').children.length > 0 ? 'grid' : 'none';
                document.getElementById('catalogo-pessoal-empty').style.display = document.getElementById('catalogo-pessoal-grid').children.length === 0 ? 'block' : 'none';
            }

            const offsetPosition = sectionElement.getBoundingClientRect().top + window.pageYOffset - headerHeight;
            window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
        }
        
        // --- Catalogo Pessoal Section Logic ---
        const suplementosPessoaisCollectionPath = `artifacts/${currentAppId}/public/data/suplementos`;
        const catalogoPessoalLoading = document.getElementById('catalogo-pessoal-loading');
        const catalogoPessoalError = document.getElementById('catalogo-pessoal-error');
        const catalogoPessoalGridContainer = document.getElementById('catalogo-pessoal-grid-container');
        const catalogoPessoalGrid = document.getElementById('catalogo-pessoal-grid');
        const catalogoPessoalEmpty = document.getElementById('catalogo-pessoal-empty');
        const catalogoPessoalDetalhesContainer = document.getElementById('catalogo-pessoal-detalhes-container');
        let unsubscribeCatalogoPessoal = null;

        function renderCatalogoPessoal(suplementos) {
            catalogoPessoalGrid.innerHTML = '';
            if (suplementos.length === 0) {
                catalogoPessoalGrid.style.display = 'none';
                catalogoPessoalEmpty.style.display = 'block';
                catalogoPessoalEmpty.innerHTML = `
                    ${iconSVG.bookOpen.replace('width="18" height="18"', 'width="48" height="48"').replace('class="', 'class="mx-auto text-slate-400 mb-4 ')}
                    <p class="text-xl text-slate-600 mb-2">Seu catálogo pessoal está vazio.</p>
                    <p class="text-slate-500 mb-6">Adicione suplementos através da seção "Adicionar Novo Suplemento" ou da Biblioteca.</p>
                    <button id="catalogo-empty-add-btn" class="cta-button-catalogo-pessoal"> 
                        ${iconSVG.plusCircle.replace('width="18" height="18"', 'width="22" height="22"').replace('class="', 'class="mr-2.5 ')}
                        Adicionar Suplemento
                    </button>
                `;
                document.getElementById('catalogo-empty-add-btn').addEventListener('click', (e) => handleNavigate(e, 'adicionarSuplemento'));

            } else {
                catalogoPessoalGrid.style.display = 'grid';
                catalogoPessoalEmpty.style.display = 'none';
                suplementos.forEach(sup => {
                    const colors = sup.imagemPlaceholder ? extractColorsFromPlaceholder(sup.imagemPlaceholder) : { bgColor: '#f3f4f6', textColor: '#374151' };
                    const card = document.createElement('div');
                    card.className = 'suplemento-card-custom group';
                    card.style.backgroundColor = colors.bgColor;
                    card.addEventListener('click', () => showSuplementoDetalhes(sup, 'catalogoPessoal'));
                    card.innerHTML = `
                        <div class="suplemento-card-content-custom">
                            <h3 class="suplemento-card-title-custom" style="color: ${colors.textColor};">${sup.nome}</h3>
                        </div>
                    `;
                    catalogoPessoalGrid.appendChild(card);
                });
            }
        }

        function loadCatalogoPessoal() {
            if (!fbDb || !currentUserId) {
                catalogoPessoalLoading.style.display = 'none';
                catalogoPessoalError.textContent = "Autenticação ou banco de dados não disponível.";
                catalogoPessoalError.style.display = 'block';
                return;
            }

            catalogoPessoalLoading.style.display = 'block';
            catalogoPessoalError.style.display = 'none';
            catalogoPessoalGridContainer.style.display = 'block'; 

            const suplementosRef = collection(fbDb, suplementosPessoaisCollectionPath);
            const q = query(suplementosRef); 

            if (unsubscribeCatalogoPessoal) unsubscribeCatalogoPessoal(); 

            unsubscribeCatalogoPessoal = onSnapshot(q, (querySnapshot) => {
                const suplementosData = [];
                querySnapshot.forEach((doc) => {
                    suplementosData.push({ id: doc.id, ...doc.data() });
                });
                suplementosData.sort((a, b) => a.nome.localeCompare(b.nome));
                renderCatalogoPessoal(suplementosData);
                catalogoPessoalLoading.style.display = 'none';
            }, (err) => {
                console.error("Erro ao buscar suplementos pessoais:", err);
                catalogoPessoalError.textContent = "Não foi possível carregar seus suplementos pessoais.";
                catalogoPessoalError.style.display = 'block';
                catalogoPessoalLoading.style.display = 'none';
            });
        }
        
        // --- Assistente Interacoes Section Logic ---
        const item1InteracaoInput = document.getElementById('item1-interacao');
        const item2InteracaoInput = document.getElementById('item2-interacao');
        const verificarInteracaoBtn = document.getElementById('verificar-interacao-btn');
        const verificarInteracaoBtnText = document.getElementById('verificar-interacao-btn-text');
        const interacaoResultadoContainer = document.getElementById('interacao-resultado-container');
        const geminiApiKey = ""; 

        verificarInteracaoBtn.addEventListener('click', async () => {
            const item1 = item1InteracaoInput.value.trim();
            const item2 = item2InteracaoInput.value.trim();

            if (!item1 || !item2) {
                interacaoResultadoContainer.innerHTML = "<p class='text-red-600 font-medium'>Por favor, insira os dois itens para verificação.</p>";
                interacaoResultadoContainer.style.display = 'block';
                return;
            }
            if (item1.toLowerCase() === item2.toLowerCase()) {
                interacaoResultadoContainer.innerHTML = "<p class='text-orange-600 font-medium'>Você inseriu o mesmo item duas vezes. Por favor, insira dois itens diferentes.</p>";
                interacaoResultadoContainer.style.display = 'block';
                return;
            }

            verificarInteracaoBtn.disabled = true;
            verificarInteracaoBtnText.textContent = 'Analisando...';
            interacaoResultadoContainer.innerHTML = "<div class='loader-custom'></div><p class='text-center text-slate-600'>Analisando interação com IA... Por favor, aguarde.</p>";
            interacaoResultadoContainer.style.display = 'block';
            
            interacaoResultadoContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });

            const prompt = `Por favor, analise a possível interação medicamentosa e/ou alimentar entre "${item1}" e "${item2}". Descreva de forma clara e concisa: 1. A natureza da possível interação (exemplo: farmacocinética, farmacodinâmica, sinergia, antagonismo). 2. Os riscos potenciais ou efeitos adversos que podem surgir. 3. Recomendações gerais ou precauções a serem consideradas. 4. Se a combinação é geralmente considerada segura, de baixo risco, requer cautela, ou deve ser evitada. Enfatize que esta informação é para fins educativos, gerada por IA, e não substitui o aconselhamento de um profissional de saúde qualificado (médico, farmacêutico, nutricionista). Recomende fortemente a consulta a um profissional antes de tomar qualquer decisão sobre saúde ou tratamento. Formate a resposta com parágrafos curtos e use negrito para destacar os pontos chave (use tags HTML <strong> para negrito e <p> para parágrafos).`;
            
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`;
            
            let mensagem = "";
            try {
                const response = await fetch(apiUrl, { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify(payload) 
                });

                if (!response.ok) {
                    let errorDetails = `Erro HTTP: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorDetails += ` - ${errorData.error?.message || JSON.stringify(errorData)}`;
                    } catch (e) { /* Ignore JSON parsing error */ }
                    throw new Error(errorDetails);
                }

                const result = await response.json();
                if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts[0].text) {
                    let text = result.candidates[0].content.parts[0].text;
                    text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); 
                    const formattedText = text.split('\n').map(paragraph => `<p>${paragraph}</p>`).join('');
                    mensagem = `<h4 class='text-lg font-semibold text-red-700 mb-3'>Análise da Interação (Fornecida por IA):</h4><div class='space-y-3 text-sm prose-gemini'>${formattedText}</div>`;
                } else {
                    mensagem = "<p class='text-orange-600 font-medium'>Não foi possível obter uma resposta da IA para esta combinação. Verifique os termos inseridos ou tente novamente mais tarde.</p>";
                    if (result.promptFeedback && result.promptFeedback.blockReason) {
                        mensagem += `<p class='text-xs text-slate-500 mt-1'>Motivo do bloqueio pela IA: ${result.promptFeedback.blockReason}</p>`;
                    }
                }
            } catch (error) {
                console.error("Erro ao chamar a API Gemini:", error);
                mensagem = `<p class='text-red-600 font-medium'>Ocorreu um erro ao tentar verificar a interação. Por favor, tente novamente mais tarde.</p><p class='text-xs text-slate-500 mt-1'>Detalhes do erro: ${error.message}</p>`;
            }
            interacaoResultadoContainer.innerHTML = mensagem;
            verificarInteracaoBtn.disabled = false;
            verificarInteracaoBtnText.innerHTML = `${iconSVG.sparkles.replace('width="18" height="18"', 'width="20" height="20"').replace('class="', 'class="mr-2 inline "')} Analisar Interação com IA`;
        });

        // --- Calculadora Nutricional Section Logic ---
        const calculadoraNutricionalForm = document.getElementById('calculadora-nutricional-form');
        const nutricaoResultadoContainer = document.getElementById('nutricao-resultado-container');

        function getBMICategory(bmi) {
            if (bmi < 18.5) return "Abaixo do peso";
            if (bmi < 24.9) return "Peso normal";
            if (bmi < 29.9) return "Sobrepeso";
            if (bmi < 34.9) return "Obesidade Grau I";
            if (bmi < 39.9) return "Obesidade Grau II";
            return "Obesidade Grau III (Mórbida)";
        }

        calculadoraNutricionalForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(calculadoraNutricionalForm);
            const idade = parseInt(formData.get('idade'));
            const sexo = formData.get('sexo');
            const peso = parseFloat(formData.get('peso'));
            const alturaCm = parseInt(formData.get('altura'));
            const atividade = parseFloat(formData.get('atividade'));

            if (isNaN(idade) || isNaN(peso) || isNaN(alturaCm) || !sexo || !atividade || idade <=0 || peso <=0 || alturaCm <=0) {
                nutricaoResultadoContainer.innerHTML = "<p class='text-red-600 font-medium'>Por favor, preencha todos os campos com valores válidos.</p>";
                nutricaoResultadoContainer.style.display = 'block';
                return;
            }
            
            let tmb; 
            if (sexo === 'masculino') {
                tmb = (10 * peso) + (6.25 * alturaCm) - (5 * idade) + 5;
            } else { 
                tmb = (10 * peso) + (6.25 * alturaCm) - (5 * idade) - 161;
            }
            const get = tmb * atividade; 

            const proteinasCalorias = get * 0.30; 
            const proteinasGramas = proteinasCalorias / 4;
            const gordurasCalorias = get * 0.30; 
            const gordurasGramas = gordurasCalorias / 9;
            const carboidratosCalorias = get * 0.40; 
            const carboidratosGramas = carboidratosCalorias / 4;

            const aguaLitros = ((peso * 35) / 1000).toFixed(1);

            const alturaMetros = alturaCm / 100;
            const bmi = (peso / (alturaMetros * alturaMetros)).toFixed(1);
            const bmiCategory = getBMICategory(parseFloat(bmi));

            const alturaPolegadas = alturaCm / 2.54;
            let idealWeightKg;
            if (sexo === 'masculino') {
                idealWeightKg = (50 + 2.3 * (alturaPolegadas - 60)).toFixed(1);
            } else { 
                idealWeightKg = (45.5 + 2.3 * (alturaPolegadas - 60)).toFixed(1);
            }
            if (idealWeightKg < 0) idealWeightKg = "N/A (altura muito baixa para esta fórmula)";


            nutricaoResultadoContainer.innerHTML = `
                <h4 class='text-xl font-bold text-red-700 mb-4'>Suas Estimativas Nutricionais:</h4>
                <div class='space-y-2 text-slate-700'>
                    <p><strong>Taxa Metabólica Basal (TMB):</strong> <span class='font-semibold text-red-600'>${tmb.toFixed(0)} kcal/dia</span></p>
                    <p><strong>Gasto Energético Total (GET) Estimado:</strong> <span class='font-semibold text-red-600'>${get.toFixed(0)} kcal/dia</span></p>
                </div>

                <h5 class='text-lg font-semibold text-red-600 mt-6 mb-3'>Sugestão de Distribuição de Macronutrientes (Exemplo 40C/30P/30G):</h5>
                <ul class='list-none space-y-2 text-slate-700'>
                    <li><strong>Carboidratos:</strong> ${carboidratosGramas.toFixed(0)}g (<span class='text-sm'>${carboidratosCalorias.toFixed(0)} kcal</span>) - <span class='font-medium text-rose-600'>~40%</span></li>
                    <li><strong>Proteínas:</strong> ${proteinasGramas.toFixed(0)}g (<span class='text-sm'>${proteinasCalorias.toFixed(0)} kcal</span>) - <span class='font-medium text-rose-600'>~30%</span></li>
                    <li><strong>Gorduras:</strong> ${gordurasGramas.toFixed(0)}g (<span class='text-sm'>${gordurasCalorias.toFixed(0)} kcal</span>) - <span class='font-medium text-rose-600'>~30%</span></li>
                </ul>
                <p class='mt-6 text-xs text-slate-500 leading-normal'><strong>Nota Importante:</strong> Esta é uma distribuição de exemplo. Consulte um nutricionista para um plano individualizado.</p>
                
                <h5 class='text-lg font-semibold text-red-600 mt-6 mb-3'>Outras Estimativas:</h5>
                <ul class='list-none space-y-2 text-slate-700'>
                    <li><strong>Ingestão Diária de Água Recomendada:</strong> <span class='font-semibold text-red-600'>~${aguaLitros} litros</span> (baseado em 35ml/kg de peso)</li>
                    <li><strong>Índice de Massa Corporal (IMC):</strong> <span class='font-semibold text-red-600'>${bmi}</span> - Classificação: <span class='font-medium text-rose-600'>${bmiCategory}</span></li>
                    <li><strong>Peso Ideal Estimado (Fórmula de Devine):</strong> <span class='font-semibold text-red-600'>~${idealWeightKg} kg</span></li>
                </ul>
                <p class='mt-6 text-xs text-slate-500 leading-normal'><strong>Atenção:</strong> O IMC e o Peso Ideal são apenas estimativas e não consideram a composição corporal (massa muscular vs. gordura). Consulte um profissional para uma avaliação completa.</p>
            `;
            nutricaoResultadoContainer.style.display = 'block';
            nutricaoResultadoContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });

        // --- Adicionar Suplemento Section Logic ---
        const adicionarSuplementoSection = document.getElementById('adicionarSuplemento');
        const adicionarSuplementoForm = document.getElementById('adicionar-suplemento-form');
        const nomeSuplementoAddInput = document.getElementById('nomeSuplemento-add');
        const principiosAtivosAddInput = document.getElementById('principiosAtivosInput-add');
        const formaDeUsoAddInput = document.getElementById('formaDeUsoInput-add');
        const fetchDetailsBtn = document.getElementById('fetch-supplement-details-btn');
        const fetchDetailsBtnText = document.getElementById('fetch-details-btn-text');
        const fetchDetailsBtnLoading = document.getElementById('fetch-details-btn-loading');
        const saveSuplementoBtn = document.getElementById('save-suplemento-btn');
        const saveSuplementoBtnText = document.getElementById('save-suplemento-btn-text');
        const saveSuplementoBtnLoading = document.getElementById('save-suplemento-btn-loading');
        const addSuplementoErrorDiv = document.getElementById('adicionar-suplemento-error');
        const addSuplementoSuccessDiv = document.getElementById('adicionar-suplemento-success');
        const addSuplementoDetailsFields = document.getElementById('add-suplemento-details-fields');

        fetchDetailsBtn.addEventListener('click', async () => {
            const nomeSuplemento = nomeSuplementoAddInput.value.trim();
            if (!nomeSuplemento) {
                showNotification("Por favor, insira o nome do suplemento para buscar.", "error");
                return;
            }

            fetchDetailsBtn.disabled = true;
            fetchDetailsBtnText.style.display = 'none';
            fetchDetailsBtnLoading.style.display = 'inline-flex';
            addSuplementoErrorDiv.style.display = 'none';
            addSuplementoSuccessDiv.style.display = 'none';
            principiosAtivosAddInput.value = '';
            formaDeUsoAddInput.value = '';
            addSuplementoDetailsFields.style.display = 'none';


            const prompt = `Para o suplemento chamado "${nomeSuplemento}", por favor, forneça as seguintes informações de forma concisa como um objeto JSON:
            1.  "principios_ativos": Uma string listando os principais princípios ativos. Se não souber, retorne "Informação não encontrada".
            2.  "forma_de_uso_recomendada": Uma string descrevendo a forma de uso recomendada, incluindo dosagem comum, se aplicável. Se não souber, retorne "Informação não encontrada".
            Responda apenas com o objeto JSON.`;

            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "principios_ativos": { "type": "STRING" },
                            "forma_de_uso_recomendada": { "type": "STRING" }
                        },
                        required: ["principios_ativos", "forma_de_uso_recomendada"]
                    }
                }
            };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `Erro HTTP: ${response.status}`);
                }
                const result = await response.json();

                if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts[0].text) {
                    const parsedJson = JSON.parse(result.candidates[0].content.parts[0].text);
                    principiosAtivosAddInput.value = parsedJson.principios_ativos || "Informação não encontrada.";
                    formaDeUsoAddInput.value = parsedJson.forma_de_uso_recomendada || "Informação não encontrada.";
                    addSuplementoDetailsFields.style.display = 'block';
                } else {
                    throw new Error("Resposta da API Gemini em formato inesperado ou vazia.");
                }
            } catch (e) {
                console.error("Erro ao buscar detalhes do suplemento:", e);
                addSuplementoErrorDiv.textContent = `Não foi possível buscar os detalhes: ${e.message}. Por favor, preencha manualmente ou tente outro nome.`;
                addSuplementoErrorDiv.style.display = 'block';
                principiosAtivosAddInput.value = "Erro ao buscar. Preencha manualmente.";
                formaDeUsoAddInput.value = "Erro ao buscar. Preencha manualmente.";
                addSuplementoDetailsFields.style.display = 'block'; 
            } finally {
                fetchDetailsBtn.disabled = false;
                fetchDetailsBtnText.style.display = 'inline-flex';
                fetchDetailsBtnLoading.style.display = 'none';
            }
        });

        adicionarSuplementoForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            addSuplementoErrorDiv.style.display = 'none';
            addSuplementoSuccessDiv.style.display = 'none';

            const nome = nomeSuplementoAddInput.value.trim();
            const principiosAtivos = principiosAtivosAddInput.value.trim();
            const formaDeUso = formaDeUsoAddInput.value.trim();

            if (!nome || !principiosAtivos || !formaDeUso) {
                showNotification("Nome, Princípios Ativos e Forma de Uso são obrigatórios.", "error");
                return;
            }
            
            saveSuplementoBtn.disabled = true;
            saveSuplementoBtnText.style.display = 'none';
            saveSuplementoBtnLoading.style.display = 'inline-block';

            const nomeEncoded = encodeURIComponent(nome);
            const imagemPlaceholderGerada = `https://placehold.co/600x400/E11D48/FFFFFF?text=${nomeEncoded}`;

            const dataToSave = {
                nome: nome,
                principiosAtivos: principiosAtivos,
                formaDeUso: formaDeUso,
                imagemPlaceholder: imagemPlaceholderGerada,
                adicionadoEm: new Date().toISOString(),
            };

            try {
                const suplementosCollRef = collection(fbDb, suplementosPessoaisCollectionPath);
                const q = query(suplementosCollRef, where("nome", "==", dataToSave.nome));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    showNotification("Já existe um suplemento com este nome no Catálogo Pessoal.", "error");
                    saveSuplementoBtn.disabled = false;
                    saveSuplementoBtnText.style.display = 'inline-block';
                    saveSuplementoBtnLoading.style.display = 'none';
                    return;
                }

                await addDoc(suplementosCollRef, dataToSave);
                showNotification("Suplemento adicionado com sucesso ao Catálogo Pessoal!", "success");
                adicionarSuplementoForm.reset();
                addSuplementoDetailsFields.style.display = 'none';
            } catch (err) {
                console.error("Erro ao salvar suplemento:", err);
                showNotification("Erro ao salvar suplemento: " + err.message, "error");
            } finally {
                saveSuplementoBtn.disabled = false;
                saveSuplementoBtnText.style.display = 'inline-block';
                saveSuplementoBtnLoading.style.display = 'none';
            }
        });


        // --- Footer Logic ---
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        const footerUserId = document.getElementById('footer-user-id');

        // --- Auth State Change Handling ---
        onAuthStateChanged(fbAuth, async (user) => {
            if (user) {
                currentUserId = user.uid;
            } else {
                try {
                    if (initialAuthTokenFromEnv) {
                        await signInWithCustomToken(fbAuth, initialAuthTokenFromEnv);
                    } else {
                        await signInAnonymously(fbAuth);
                    }
                    currentUserId = fbAuth.currentUser ? fbAuth.currentUser.uid : crypto.randomUUID();
                } catch (error) {
                    console.error("Erro ao autenticar anonimamente:", error);
                    currentUserId = crypto.randomUUID(); 
                    showNotification("Erro de autenticação. Algumas funcionalidades podem não estar disponíveis.", "error");
                }
            }
            
            if (initialLoader) initialLoader.style.display = 'none';
            if (mainAppContent) mainAppContent.style.display = 'flex';

            if (footerUserId) {
                footerUserId.textContent = `ID Usuário: ${currentUserId}`;
                footerUserId.style.display = 'block';
            }
            
            loadCatalogoPessoal(); 
            if (fbDb && currentUserId) {
                adicionarSuplementoSection.style.display = 'block'; 
            }

            setHeaderHeight();
            renderNavLinks();
            updateActiveNavLink('inicio'); 
            renderBiblioteca();
            setupIntersectionObserver(); 
        }, (error) => {
            console.error("Erro no onAuthStateChanged:", error);
            if(initialLoader) initialLoader.style.display = 'none';
            if(firebaseErrorDisplay) firebaseErrorDisplay.style.display = 'block';
            if(firebaseErrorMessageDetail) firebaseErrorMessageDetail.textContent = "Erro durante o processo de autenticação: " + error.message;
            showNotification("Falha crítica na autenticação. Recarregue a página.", "error");
        });

        setTimeout(() => {
            if (!currentUserId && initialLoader.style.display !== 'none') {
                console.warn("Auth state timeout, proceeding with anonymous/fallback ID.");
                 currentUserId = crypto.randomUUID();
                if (initialLoader) initialLoader.style.display = 'none';
                if (mainAppContent) mainAppContent.style.display = 'flex';
                if (footerUserId) {
                    footerUserId.textContent = `ID Usuário (Fallback): ${currentUserId}`;
                    footerUserId.style.display = 'block';
                }
                loadCatalogoPessoal();
                if (fbDb && currentUserId) {
                    adicionarSuplementoSection.style.display = 'block';
                }
                setHeaderHeight();
                renderNavLinks();
                updateActiveNavLink('inicio');
                renderBiblioteca();
                setupIntersectionObserver();
            }
        }, 7000); 

        window.addEventListener('resize', () => {
            setHeaderHeight();
            setupIntersectionObserver(); 
        });

    </script>
</body>
</html>
